try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="6accc1ae-a854-4704-b37c-3606312433be",e._sentryDebugIdIdentifier="sentry-dbid-6accc1ae-a854-4704-b37c-3606312433be")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7383],{9896:(e,t,n)=>{n.d(t,{F:()=>l});var r=n(27062),i=n(67933),s=n(7620),a=n(77187),o=n(85644);let l=()=>{let e="sticky-model-selector",{value:t}=(0,r.fS)("sticky_model_selector"),{value:n}=(0,r.fS)("model_selector_enabled"),{activeModelOptions:l}=(0,o.A9)(),u=(0,a.Z3)(null),c=(0,i.useQuery)({queryKey:[e],queryFn:()=>{if(!t||!n)return null;let r=localStorage.getItem(e);return r===u?null:r&&l.find(e=>e.model===r)?r:null},initialData:null}),d=(0,s.useCallback)(t=>{t&&localStorage.setItem(e,t),c.refetch()},[c]);return{stickyModelPreference:c.data,setStickyModelPreference:d}}},17423:(e,t,n)=>{n.d(t,{M$:()=>c,O5:()=>o,f$:()=>l,lo:()=>u,n7:()=>d});var r=n(77186),i=n(1761),s=n(71473),a=n(87606);let o=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[s.ss,{orgUUID:t}]})},l=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,a.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[s.ss,{orgUUID:t}]})}})},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,i.YL)(),o=null==n?void 0:n.uuid,l=(0,a.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(o,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{l.invalidateQueries({queryKey:[s.ss,{orgUUID:o}]})},enabled:!t})},c=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,o=(0,a.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{o.invalidateQueries({queryKey:[s.ss,{orgUUID:n}]})}})},d=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},22529:(e,t,n)=>{n.d(t,{ClientIntlProvider:()=>f,O:()=>v,X5:()=>g,YX:()=>p,fl:()=>h});var r=n(54568),i=n(55428),s=n(68864),a=n(7620),o=n(88982),l=n(62971),u=n(18483);let c=new Set,d=e=>{if(e.message.includes("MISSING_TRANSLATION")){if(c.has(e.message))return;c.add(e.message)}console.error(e)},m=()=>void 0;function f(e){let{locale:t,messages:n,children:l,hideErrors:u}=e;return(0,a.useEffect)(()=>{s.wB.defaultLocale=t},[t]),(0,r.jsx)(o.A,{locale:t,messages:n,onError:u?m:(0,i.O0)()?d:void 0,fallbackOnEmptyString:!1,children:(0,r.jsx)(r.Fragment,{children:l})})}function p(e){let{id:t,values:n}=e;return(0,r.jsx)(l.A,{id:(0,u.ey)(t),defaultMessage:" ",values:n})}function g(e){let{id:t}=e;return(0,r.jsx)(l.A,{id:(0,u.lK)(t),defaultMessage:" "})}function h(e){let{id:t,intl:n}=e;return n.formatMessage({id:(0,u.lK)(t),defaultMessage:" "})}function v(e){let{id:t,intl:n}=e;return n.formatMessage({id:(0,u.ey)(t),defaultMessage:" "})}},27630:(e,t,n)=>{n.d(t,{r:()=>r});function r(e,t){return Object.fromEntries(Object.entries(t).map(t=>{let[n,r]=t;return[n.startsWith("".concat(e,"."))?n:"".concat(e,".").concat(n),r]}))}},32442:(e,t,n)=>{function r(e){let t=e,n="",r=0;for(;t!==n&&r<10;)n=t,t=(t=(t=(t=t.normalize("NFKC")).replace(RegExp("[\\p{Cf}\\p{Co}\\p{Cn}]","gu"),"")).replace(RegExp("[\\p{Cc}]","gu"),e=>"\n"===e||"	"===e||"\r"===e?e:"")).replace(/[\u200B-\u200F]/g,"").replace(/[\u202A-\u202E]/g,"").replace(/[\u2066-\u2069]/g,"").replace(/[\uFEFF]/g,"").replace(/[\uE000-\uF8FF]/g,""),r++;if(r>=10)throw Error("Unicode sanitization reached maximum iterations (".concat(10,") for input: ").concat(e.slice(0,100)));return t}n.d(t,{M:()=>function e(t){if("string"==typeof t)return r(t);if(Array.isArray(t))return t.map(e);if(null!==t&&"object"==typeof t){let n={};for(let[r,i]of Object.entries(t))n[e(r)]=e(i);return n}return t},P:()=>r})},42685:(e,t,n)=>{n.d(t,{OpusRateLimitModalProvider:()=>l,T:()=>o});var r=n(54568),i=n(7620),s=n(71165);let a=null;function o(){a&&a(!0)}function l(){let[e,t]=(0,i.useState)(!1);return(0,i.useEffect)(()=>(a=t,()=>{a=null}),[]),(0,r.jsx)(s.v,{isOpen:e,onClose:()=>t(!1),limitType:"opus"})}},45727:(e,t,n)=>{n.d(t,{p:()=>a});var r=n(46127),i=n(27062),s=n(17423);let a=()=>{let{value:e}=(0,i.fS)("concise_mode_enabled"),{data:t,isLoading:n}=(0,s.O5)(),a=(null==t?void 0:t.defaultStyles)||[],o=[...a,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[l,u,c]=(0,r.Vc)("claude_personalized_style",null);if(n||!(null==o?void 0:o.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e};let d=a.length?a.find(e=>!0===e.isDefault)||a[0]:null;if(e&&(d=a.find(e=>"Concise"===e.key)||d),!l)return{personalizedStyleOptions:o,defaultStyle:d,storedStyle:l,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e};let m=o.find(e=>((e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t)(e,l.styleKey)),f=Date.now()-new Date(l.timestamp).getTime()>432e5;return{personalizedStyleOptions:o,storedStyle:m&&!f?m:null,defaultStyle:d,setStoredStyle:u,clearStoredStyle:c,conciseModeEnabled:e}}},50707:(e,t,n)=>{n.d(t,{M:()=>a});var r=n(54568),i=n(32987),s=n(62971);function a(e){let{className:t,onClick:n,as:a="span"}=e;return(0,r.jsx)(a,{className:(0,i.A)("border-0.5 border-border-400 text-accent-secondary-000 px-1.5 py-px rounded-3xl font-small",n&&"cursor-pointer hover:border-border-300 transition-colors",t),onClick:n,children:(0,r.jsx)(s.A,{defaultMessage:"Upgrade",id:"0h/lPMeYkq"})})}},57383:(e,t,n)=>{n.d(t,{_A:()=>j,oM:()=>I});var r=n(54568),i=n(64683),s=n(16253),a=n(74530),o=n(9896),l=n(70958),u=n(77186),c=n(29585),d=n(7620),m=n(13368),f=n(98736),p=n(89836),g=n(98251),h=n(72697),v=n(52909),y=n(1761),b=n(69916),S=n(45727),_=n(42685),x=n(83092),C=n(75973),w=n(58004),P=n(72431),k=n(93770),M=n(46127),T=n(32442);let E={type:"doc",content:[{type:"paragraph",content:[]}]},U=d.createContext({attachments:[],files:[],transitionFiles:[],syncSourceUuids:[],isAtMaxNumUploads:!1,model:"",prompt:"",tipTapEditorState:{},projectUuid:void 0,beamChatUuid:void 0,isNewBeamChat:!1,isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setPrompt:()=>void 0,setTipTapEditorState:()=>void 0,setAttachments:()=>void 0,setFiles:()=>void 0,setSyncSourceUuids:()=>void 0,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,setBeamChatUuid:()=>void 0,setIsNewBeamChat:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,improvePrompt:()=>void 0,isImprovingPrompt:!1,isFocused:!1,setIsFocused:()=>void 0,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,isPromptUnsafe:()=>!1,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0}),I=()=>d.useContext(U),j=e=>{var t,n,I,j,A,z,O;let{onSend:L,willRedirectOnSubmit:F,onCreate:R,onStopSampling:D}=e,N=(0,d.useRef)(null);N.current||(N.current=(0,w.E)());let Y=N.current,{incognitoModeEnabled:B}=(0,P.S)(),K=(0,d.useRef)(null);(0,d.useEffect)(()=>{(0,Y.getState().setPromptInputRef)(K)},[Y]);let Q="conversation"in e,{children:W,projectUuid:G,namespace:q}=e,J=Q?e.conversation:void 0,{markMessageSent:X}=(0,x.B)(),V=(0,d.useCallback)(()=>{Q&&D&&D()},[D,Q]);(e=>{let t=(0,d.useCallback)(t=>{if(e&&!(e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")))(document.activeElement)&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;if(!(" "===t.key&&(e=>{if(!e)return!1;let t=e.tagName;return"BUTTON"===t||"SUMMARY"===t||"SELECT"===t||("INPUT"===t?["button","submit","reset","checkbox","radio"].includes(e.type):["button","checkbox","radio","switch","menuitem","menuitemcheckbox","menuitemradio","option"].includes(e.getAttribute("role")||""))})(document.activeElement)))t.preventDefault(),null==(n=e.getEditor())||n.chain().insertContent(t.key).focus().run()}},[e]);(0,d.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])})(K.current);let{tipTapEditorState:H,setTipTapEditorText:Z,setTipTapEditorJSON:$,isTipTapEditorStateUnsafe:ee,attachments:et,setAttachments:en,files:er,setFiles:ei,syncSourceUuids:es,setSyncSourceUuids:ea,clear:eo}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,r="".concat(n?"".concat(n,":"):"").concat(e),[i,s,o]=(0,M.Vc)("".concat(r,":attachment"),[]),[l,u,c]=(0,M.Vc)("".concat(r,":files"),[]),[m,f,p]=(0,M.Vc)("".concat(r,":syncSourceUuids"),[]),[g,h,v]=(0,M.Vc)("".concat(r,":textInput"),t?{type:"doc",content:[{type:"paragraph",content:[{type:"text",text:t}]}]}:E),y=(0,d.useCallback)(()=>!!g.__ant_unsafe,[g]),b=(0,d.useCallback)((e,t)=>{let n=(0,T.P)(e),r={type:"doc",content:[{type:"paragraph",content:[{type:"text",text:n}]}]};return n.length>0&&t&&(r.__ant_unsafe=!0),h(r),n},[h]);return{attachments:i,setAttachments:s,files:l,setFiles:u,syncSourceUuids:m,setSyncSourceUuids:f,tipTapEditorState:g,setTipTapEditorJSON:(0,d.useCallback)(e=>{let t=(0,a.h0)(e);return t.length>0&&y()&&(e.__ant_unsafe=!0),h(e),t},[h,y]),setTipTapEditorText:b,isTipTapEditorStateUnsafe:y,clear:(0,d.useCallback)(()=>{v(),o(),c(),p()},[o,v,c,p])}}(null!=(n=null==J?void 0:J.id)?n:void 0===G?"new-conversation":"".concat(G,":conversation"),"",q),el=(0,d.useRef)(H),eu=(0,d.useRef)(!1);(0,d.useEffect)(()=>{if(!eu.current){let e=el.current?(0,a.h0)(el.current):"";Y.getState().setPrompt(e,{forceUpdateTiptap:!1}),eu.current=!0}},[Y]);let ec=(0,m.P)(Y,e=>e.prompt),ed=(0,d.useCallback)(e=>{let t=$(e);Y.getState().setPrompt(t,{forceUpdateTiptap:!1})},[$,Y]),em=(0,d.useCallback)(function(e){let{forceUpdateTiptap:t=!0,unsafe:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Z(e,n);Y.getState().setPrompt(r,{forceUpdateTiptap:t,unsafe:n})},[Z,Y]),ef=(0,p.NY)(es),ep=(0,p.qJ)(ef),eg=(0,u.B7)(ef),eh=et.length+er.length+es.length>=s.XA.maxTotalUploadsPerMessage,{isModelSelectorOpen:ev,isSending:ey,isFocused:eb,isUploadingDriveSync:eS,isUploadingGithubSync:e_,personalizedStyle:ex,includeProfilePreferences:eC,currentCompassTask:ew}=(0,m.P)(Y,(0,f.k)(e=>({isModelSelectorOpen:e.isModelSelectorOpen,isSending:e.isSending,isFocused:e.isFocused,isUploadingDriveSync:e.isUploadingDriveSync,isUploadingGithubSync:e.isUploadingGithubSync,personalizedStyle:e.personalizedStyle,includeProfilePreferences:e.includeProfilePreferences,currentCompassTask:e.currentCompassTask}))),eP=Y.getState().setIsModelSelectorOpen,ek=Y.getState().setIsSending,eM=Y.getState().setIsFocused,eT=Y.getState().setIsUploadingDriveSync,eE=Y.getState().setIsUploadingGithubSync,eU=Y.getState().setPersonalizedStyle,eI=Y.getState().setIncludeProfilePreferences,ej=Y.getState().setCurrentCompassTask,eA=Y.getState().setModel,ez=Y.getState().setConversation,eO=Y.getState().setPendingConversationSettings,eL=Y.getState().setSyncSourceUuids,[eF,eR]=d.useState(),{stickyModelPreference:eD}=(0,o.F)(),eN=null!=(A=null!=(j=null!=(I=null==J?void 0:J.model)?I:eF)?j:eD)?A:void 0,[eY,eB]=d.useState(),eK=(0,d.useMemo)(()=>({}),[]),eQ=Y.getState();(0,d.useLayoutEffect)(()=>{eQ.model!==eN&&eA(eN),eQ.conversation!==J&&ez(J);let e=null!=eY?eY:eK,t=eQ.pendingConversationSettings,n=!t||0===Object.keys(t).length,r=!eY||0===Object.keys(eY).length;n&&r||t===e||eO(e),eQ.syncSourceUuids!==es&&eL(es)});let eW=(0,d.useCallback)(e=>{eB(t=>{let n={...t,...e};return eO(n),n})},[eO]),eG=(0,d.useCallback)(e=>{ea(e),eL(e)},[ea,eL]),[eq,eJ]=d.useState(G),eX=(0,h.Ah)(),{mutate:eV}=(0,g.nI)(),eH=(0,d.useCallback)(e=>{eJ(e),eX&&e&&eV&&eV({project_uuid:e})},[eX,eV]),eZ=(0,v.ks)(eq),{beamUuid:e$}=(0,C.d)(),[e0,e1]=d.useState(e$),[e2,e7]=d.useState(!1),e6=(0,d.useCallback)(e=>{e1(e),e&&e7(!1)},[]),e5=(0,d.useCallback)(e=>{e7(e),e&&e1(void 0)},[]),[e3,e4]=d.useState(),{storedStyle:e9,defaultStyle:e8}=(0,S.p)();(0,d.useEffect)(()=>{let e=null!=e9?e9:e8;!ex&&e&&eU(e)},[e9,e8,ex,eU]),(0,d.useEffect)(()=>{G&&eq!==G&&eH(G)},[G,eq,eH]);let te="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null;(0,d.useEffect)(()=>{e4(void 0),ek(!1)},[null==J?void 0:J.id,ek]),(0,d.useEffect)(()=>{null==te||te(ex)},[ex,te]);let tt=(0,d.useCallback)(async()=>{if(K.current&&(""!==ec.trim()||0!==et.length||0!==er.length||0!==es.length)){F&&e4([...er]),eo(),Y.getState().setPrompt("",{forceUpdateTiptap:!1}),F?K.current.setEditable(!1):K.current.setContent(""),ek(!0);try{if(X(),Q&&L)await L({prompt:ec,attachments:et,files:er,syncSources:eg,personalized_style:ex}),ek(!1),e4(void 0);else{let e=Y.getState().pendingConversationSettings;await R({prompt:ec,attachments:et,files:er,syncSources:eg,model:eN,project_uuid:eq,is_new_beam_chat:e2||void 0,beam_chat_uuid:e0,personalized_style:ex,include_conversation_preferences:eC,is_temporary:B,...e})}}catch(t){var e;if(t instanceof c.LG&&"opus_messages_rate_limit_exceeded"===t.errorCode)(0,_.T)();else throw t;em(ec),null==(e=K.current)||e.setContent(ec),en(et),ei(er),ea(es),K.current.setEditable(!0),ek(!1),e4(void 0)}}},[et,eo,er,eC,Q,eN,R,L,ex,eq,ec,en,ei,em,ea,es,eg,F,B,Y,ek,X,e2,e0]),tn=(0,d.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&Q){ek(!0);try{L&&(await L({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:ex}),ek(!1))}catch(e){if(e instanceof c.LG&&"opus_messages_rate_limit_exceeded"===e.errorCode)(0,_.T)();else throw e;ek(!1)}}},[Q,L,ex,ek]),{streamImprovement:tr,isStreaming:ti}=function(){let{activeOrganization:e}=(0,y.YL)(),[t,n]=(0,d.useState)(!1),[r,i]=(0,d.useState)(null),s=(0,d.useRef)(null),{addError:a}=(0,b.Y)(),o=(0,d.useCallback)(async(t,r,o,l)=>{s.current&&s.current.abort();let u=new AbortController;s.current=u,n(!0),i(null);let c="/api/organizations/".concat(null==e?void 0:e.uuid,"/prompt/improve/stream");try{var d,m,f;let e=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include",signal:u.signal});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=null==(d=e.body)?void 0:d.getReader(),i=new TextDecoder;if(!n)throw Error("No response body");let s="",a="",l=!1;for(;!l;){let e=await n.read();if(e.done){l=!0;break}let t=e.value,u=(s+=i.decode(t,{stream:!0})).split("\n");for(let e of(s=u.pop()||"",u))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{let e=JSON.parse(t);switch(e.type){case"content_block_delta":(null==(m=e.delta)?void 0:m.text)&&(a+=e.delta.text,r(e.delta.text));break;case"message_stop":o(e.improved_prompt||a);break;case"error":throw Error((null==(f=e.error)?void 0:f.message)||"Unknown error occurred")}}catch(e){}}else e.startsWith("event: ")&&e.slice(7)}}catch(t){if(t instanceof Error&&"AbortError"===t.name)return;let e=t instanceof Error?t:Error(String(t));i(e),null==l||l(e),a("Failed to improve prompt: "+e.message,{error:e})}finally{n(!1),s.current===u&&(s.current=null)}},[null==e?void 0:e.uuid,a]);return(0,d.useEffect)(()=>()=>{s.current&&s.current.abort()},[]),{streamImprovement:o,isStreaming:t,error:r}}(),ts=(0,d.useCallback)(async()=>{var e,t,n,r;if(!ec.trim())return;null==(e=K.current)||e.setEditable(!1);let i="",s=!1;try{await tr({conversation_uuid:(null==J?void 0:J.id)||"new-conversation",prompt:ec},e=>{var t,n,r;s||(s=!0,em(""),null==(r=K.current)||r.setContent("")),i+=e,em(i,{forceUpdateTiptap:!1}),null==(t=K.current)||t.setContent(i),null==(n=K.current)||n.scrollToEnd()},e=>{var t;em(e),null==(t=K.current)||t.setContent(e)},e=>{var t;em(ec),null==(t=K.current)||t.setContent(ec)})}catch(e){em(ec),null==(t=K.current)||t.setContent(ec)}finally{null==(n=K.current)||n.setEditable(!0),null==(r=K.current)||r.focus()}},[ec,null==J?void 0:J.id,tr,em]),ta=(0,d.useCallback)(async e=>{if(eR(e),eA(e),Q){ek(!0);try{var t;await R({prompt:ec,attachments:et,files:er,syncSources:eg,model:e,project_uuid:eq,create_mode:null==J||null==(t=J.conversationSettings)?void 0:t.create_mode,...eY})}finally{ek(!1)}}},[eY,et,er,Q,eq,ec,R,eg,null==J||null==(t=J.conversationSettings)?void 0:t.create_mode,ek,eA]),to=(0,d.useCallback)(()=>{var e;return null==(e=K.current)?void 0:e.focus()},[K]),[tl,tu]=d.useState(!1),tc=(0,s.cV)(),td=(0,l.R)(),[tm,tf,tp,tg,th,tv,ty,tb]=(0,i.Si)({syncSourceCount:es.length,attachments:et,setAttachments:en,numExistingConversationAttachments:null!=(z=null==J?void 0:J.attachmentsSoFar)?z:0,files:er,setFiles:ei,numExistingConversationFiles:null!=(O=null==J?void 0:J.files.length)?O:0,detectSameAttachment:()=>!1,selectedModel:eN,conversationUuid:null==J?void 0:J.id,blobFileUploadsEnabled:tc,wiggleEnabled:td}),tS=et.length+er.length,t_=es.length,tx=tm||eS||e_,tC=tS>0||t_>0||tx,tw=(0,d.useMemo)(()=>{var t;return{prompt:ec,tipTapEditorState:H,attachments:et,files:e.willRedirectOnSubmit&&ey?null!=e3?e3:[]:er,syncSourceUuids:es,isAtMaxNumUploads:eh,isUploadingDriveSync:eS,isUploadingGithubSync:e_,model:eN,projectUuid:eq,beamChatUuid:e0,isNewBeamChat:e2,isChatSyncing:ep,personalizedStyle:ex,isProjectSyncing:eZ,isNewConversation:void 0===J||0===J.messagesSoFar,isProjectLocked:void 0!==G||void 0!==J,isSending:ey,setPrompt:em,setTipTapEditorState:ed,setAttachments:en,setFiles:ei,setSyncSourceUuids:eG,setModel:ta,setProjectUuid:eH,setBeamChatUuid:e6,setIsNewBeamChat:e5,sendMessage:tt,sendTransparentMessage:tn,improvePrompt:ts,isImprovingPrompt:ti,stopSampling:V,conversation:J,focusInput:to,isFocused:eb,setIsFocused:eM,promptInputRef:K,willRedirectOnSubmit:null!=(t=e.willRedirectOnSubmit)&&t,hasBlockingWarning:tl,setHasBlockingWarning:tu,setPersonalizedStyle:eU,setIsUploadingDriveSync:eT,setIsUploadingGithubSync:eE,includeProfilePreferences:eC,setIncludeProfilePreferences:eI,pendingConversationSettings:eY,setPendingConversationSettings:eW,isUploadingFile:tm,setIsUploadingFile:tf,validateMaxUploadLimit:tp,onDrop:tg,onPasteFiles:th,handleUpload:tv,uploadInputProps:tb,hasAttachments:tC,isModelSelectorOpen:ev,setIsModelSelectorOpen:eP,isPromptUnsafe:ee,currentCompassTask:ew,setCurrentCompassTask:ej}},[et,J,er,to,G,tl,eC,eh,ep,eb,eZ,ey,eS,e_,eN,ex,eq,eH,e0,e2,ec,e.willRedirectOnSubmit,tt,tn,ts,ti,en,ei,ta,eY,eW,e6,e5,em,eG,ed,V,es,H,e3,tm,tf,tp,tg,th,tv,tb,tC,ev,eP,ee,ew,ej,eI,eM,eT,eE,eU]);return(0,r.jsx)(k.jM,{value:Y,children:(0,r.jsx)(U.Provider,{value:tw,children:W})})}},58004:(e,t,n)=>{n.d(t,{E:()=>s});var r=n(35313),i=n(26768);let s=()=>(0,i.y)()((0,r.eh)(function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return{...((e,t)=>({prompt:"",setPrompt:function(n){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{forceUpdateTiptap:i=!0,unsafe:s=!1}=r;if(e({prompt:n}),!0===i){var a;let e=t().promptInputRef;null==e||null==(a=e.current)||a.setContent(n)}}}))(...t),...((e,t)=>({attachments:[],files:[],syncSourceUuids:[],transitionFiles:[],setAttachments:n=>{e({attachments:"function"==typeof n?n(t().attachments):n})},setFiles:n=>{e({files:"function"==typeof n?n(t().files):n})},setSyncSourceUuids:n=>{e({syncSourceUuids:"function"==typeof n?n(t().syncSourceUuids):n})},setTransitionFiles:t=>{e({transitionFiles:t})}}))(...t),...(e=>({model:"",projectUuid:void 0,beamChatUuid:void 0,isNewBeamChat:!1,pendingConversationSettings:{},conversation:void 0,setModel:t=>e({model:t}),setProjectUuid:t=>e({projectUuid:t}),setBeamChatUuid:t=>e({beamChatUuid:t}),setIsNewBeamChat:t=>e({isNewBeamChat:t}),setPendingConversationSettings:t=>e(e=>({pendingConversationSettings:{...e.pendingConversationSettings,...t}})),setConversation:t=>e({conversation:t})}))(...t),...(e=>({isFocused:!1,isModelSelectorOpen:!1,hasBlockingWarning:!1,personalizedStyle:void 0,includeProfilePreferences:!0,currentCompassTask:void 0,setIsFocused:t=>e({isFocused:t}),setIsModelSelectorOpen:t=>e({isModelSelectorOpen:t}),setHasBlockingWarning:t=>e({hasBlockingWarning:t}),setPersonalizedStyle:t=>e({personalizedStyle:t}),setIncludeProfilePreferences:t=>e({includeProfilePreferences:t}),setCurrentCompassTask:t=>e({currentCompassTask:t})}))(...t),...(e=>({isUploadingFile:!1,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingFile:t=>e({isUploadingFile:t}),setIsUploadingDriveSync:t=>e({isUploadingDriveSync:t}),setIsUploadingGithubSync:t=>e({isUploadingGithubSync:t})}))(...t),...(e=>({isSending:!1,isImprovingPrompt:!1,setIsSending:t=>e({isSending:t}),setIsImprovingPrompt:t=>e({isImprovingPrompt:t})}))(...t),...(()=>({isAtMaxNumUploads:!1,hasAttachments:!1,isChatSyncing:!1,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,willRedirectOnSubmit:!1}))(...t),...(()=>({sendMessage:void 0,sendTransparentMessage:void 0,stopSampling:void 0,focusInput:void 0,improvePrompt:void 0,validateMaxUploadLimit:void 0,onDrop:void 0,onPasteFiles:void 0,handleUpload:void 0,uploadInputProps:void 0}))(...t),...(e=>({promptInputRef:void 0,setPromptInputRef:t=>e({promptInputRef:t})}))(...t)}}))},71165:(e,t,n)=>{n.d(t,{S:()=>m,v:()=>d});var r=n(54568),i=n(41417),s=n(76761),a=n(60265),o=n(62942),l=n(25173),u=n(62971),c=n(50707);function d(e){let{isOpen:t,onClose:n,limitType:d="projects",customTitle:m,customDescription:f}=e,p=(0,o.useRouter)(),g=["opus"===d?{defaultMessage:"More Opus usage*",id:"JxRTAGj5OB"}:"message_limit"===d?{defaultMessage:"Access to tools like research and web search",id:"message_limit_benefit_tools"}:{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"opus"===d&&{defaultMessage:"Access to unlimited Projects to organize chats and documents",id:"uK9wA9v6Z3"},"projects"===d&&{defaultMessage:"More usage*",id:"Rve6Z5dM8k"},"message_limit"===d&&{defaultMessage:"Claude Code directly in your terminal",id:"message_limit_benefit_code"},"message_limit"===d&&{defaultMessage:"Integration to Google Workspace: email, calendar, and docs",id:"message_limit_benefit_workspace"},"message_limit"===d&&{defaultMessage:"Full access to the newest Claude models including Opus",id:"message_limit_benefit_models"},"message_limit"===d&&{defaultMessage:"Extended thinking for complex work",id:"message_limit_benefit_thinking"},"message_limit"!==d&&{defaultMessage:"Ability to search the web",id:"dl29r7OlXE"},"message_limit"!==d&&{defaultMessage:"Extended thinking for complex work",id:"mENE7vJhVQ"},"message_limit"!==d&&{defaultMessage:"Connect Google Workspace: email, calendar, and docs",id:"WwXweMd3IE"},"message_limit"!==d&&{defaultMessage:"Ability to use more Claude models",id:"Qpr1Da1f7N"}].filter(Boolean);return(0,r.jsx)(l.bL,{open:t,onOpenChange:n,children:(0,r.jsx)(l.ZL,{children:(0,r.jsx)(l.hJ,{className:"fixed inset-0 bg-always-black/50 backdrop-brightness-75 z-modal flex items-center justify-center data-[state=open]:animate-[fade_250ms_ease-in_forwards] data-[state=closed]:animate-[fade_125ms_ease-out_reverse_forwards]",children:(0,r.jsxs)(l.UC,{className:"z-modal w-full max-w-sm bg-bg-000 rounded-2xl shadow-xl overflow-hidden focus:outline-none data-[state=open]:animate-[zoom_250ms_ease-in_forwards] data-[state=closed]:animate-[zoom_125ms_ease-out_reverse_forwards]",onEscapeKeyDown:e=>{e.preventDefault(),n()},onInteractOutside:e=>{e.preventDefault(),n()},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between px-5 pt-4",children:[(0,r.jsx)(c.M,{}),(0,r.jsx)(l.bm,{asChild:!0,children:(0,r.jsx)(i.$,{variant:"ghost",size:"icon_sm",className:"text-text-400 hover:text-text-200",children:(0,r.jsx)(s.X,{size:20,weight:"regular"})})})]}),(0,r.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,r.jsx)("h2",{className:"text-[24px] leading-tight font-medium mb-2 text-text-000",children:m||("opus"===d?(0,r.jsx)(u.A,{defaultMessage:"More Opus with Pro and Max plans",id:"//ixi/rP/O"}):"message_limit"===d?(0,r.jsx)(u.A,{defaultMessage:"Keep chatting with Claude",id:"u3sKHTmxou"}):(0,r.jsx)(u.A,{defaultMessage:"Unlimited projects with Pro and Max plans",id:"RKBJDiWP1p"}))}),(0,r.jsx)("p",{className:"".concat("message_limit"===d?"text-sm":"text-base"," text-text-300 mb-3"),children:f||("opus"===d?(0,r.jsx)(u.A,{defaultMessage:"Free plans only get 3 Opus messages per week. Try again after {date}, or upgrade now to get:",id:"IIJcLbtXZK",values:{date:new Date(Date.now()+6048e5).toLocaleDateString("en-US",{month:"long",day:"numeric"})}}):"message_limit"===d?(0,r.jsx)(u.A,{defaultMessage:"You just hit your free message limit. Upgrade to Pro (or Max) to send more messages. You also get:",id:"vXAAoQRvRg"}):(0,r.jsx)(u.A,{defaultMessage:"Free plans only get access to one Project. Upgrade now to get:",id:"NOiyw9Bber"}))}),(0,r.jsx)("div",{className:"space-y-1.5 mb-6",children:g.map((e,t)=>(0,r.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,r.jsx)(a.J,{className:"text-text-400 mt-0.5 flex-shrink-0",size:18,weight:"regular"}),(0,r.jsx)("span",{className:"text-sm text-text-200",children:(0,r.jsx)(u.A,{...e})})]},"benefit-".concat(t)))}),("opus"===d||"projects"===d)&&(0,r.jsx)("p",{className:"text-xs text-text-400 mb-4",children:(0,r.jsx)("a",{href:"https://support.anthropic.com/en/articles/11049762-choosing-a-claude-ai-plan",target:"_blank",rel:"noopener noreferrer",className:"text-text-400 underline hover:text-text-300",children:(0,r.jsx)(u.A,{defaultMessage:"*Usage limits apply",id:"HFRZOFWXCf"})})}),(0,r.jsx)(i.$,{variant:"primary",size:"lg",className:"w-full text-base font-medium",onClick:()=>{n(),p.push("/upgrade")},children:(0,r.jsx)(u.A,{defaultMessage:"See plans",id:"vbFKkTYpN+"})})]})]})})})})}let m=d},72431:(e,t,n)=>{n.d(t,{S:()=>d,r:()=>m});var r=n(54568),i=n(89256),s=n.n(i),a=n(62942),o=n(7620),l=n(72697);let u="incognito",c=o.createContext({incognitoModeEnabled:!1,setIncognitoModeEnabled:s(),temporaryConversationUUID:null,setTemporaryConversationUUID:s()}),d=()=>o.useContext(c),m=e=>{let{children:t}=e,n=(0,a.useRouter)(),i=(0,a.useSearchParams)(),s=(0,l.I_)(),d=i.has(u),[m,f]=(0,o.useState)(d),p=(0,o.useRef)(m),[g,h]=(0,o.useState)(null);(0,o.useEffect)(()=>{p.current=m},[m]);let v=(0,o.useCallback)(e=>{if(f(e),e)n.push("?".concat(u));else{h(null);let e=new URLSearchParams(i.toString());e.delete(u);let t=e.toString();n.push("".concat(window.location.pathname).concat(t?"?".concat(t):""),void 0)}},[n,i]);(0,o.useEffect)(()=>{p.current&&!d&&v(!1)},[v,d]);let y=(0,o.useMemo)(()=>({incognitoModeEnabled:!!s&&m,setIncognitoModeEnabled:v,temporaryConversationUUID:s?g:null,setTemporaryConversationUUID:h}),[m,v,g,h,s]);return(0,r.jsx)(c.Provider,{value:y,children:t})}},72697:(e,t,n)=>{n.d(t,{Uq:()=>v,I_:()=>j,BV:()=>O,Rb:()=>z,tW:()=>b,L1:()=>C,ey:()=>_,Sb:()=>S,t5:()=>A,DO:()=>P,SK:()=>T,Mf:()=>w,PB:()=>M,Ah:()=>U,UG:()=>k,lH:()=>E,xt:()=>I,mM:()=>x});var r=n(68096),i=n(77186),s=n(1761),a=n(69916),o=n(22529),l=n(71473),u=n(27062),c=n(87606),d=n(7620),m=n(46760),f=n(75006),p=n(98251);let g=e=>e.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ");var h=n(92075);let v="https://support.anthropic.com/articles/11817273-how-does-claude-s-memory-work",y=f.z.object({memory:f.z.string(),controls:f.z.array(f.z.string()).nullable(),updated_at:f.z.string().datetime({offset:!0}).nullable()}),b=(e,t)=>{var n,r;let{account:a,activeOrganization:o}=(0,s.YL)(),u=null==a?void 0:a.uuid,c=null==o?void 0:o.uuid,m=w(),f=e?"/api/organizations/".concat(c,"/memory?project_uuid=").concat(e):"/api/organizations/".concat(c,"/memory"),p=(0,i.Sk)(f,{queryKey:[l.IX,{accountUUID:u,orgUUID:c,projectUUID:e}],enabled:!!o&&(null==(r=null==t?void 0:t.enabled)||r)&&m},e=>y.parse(e)),h=(0,d.useMemo)(()=>{var e,t;return(e=>{let t;if(!e.length)return"";let n=/<([^>]+)>([\s\S]*?)<\/\1>/g,r=e,i=!0;for(;null!==(t=n.exec(e));){let[e,n,s]=t,a=g(n),o=i?"":"\n\n \n\n",l="".concat(o,"#### ").concat(a,"\n\n").concat(s.trim());r=r.replace(e,l),i=!1}return r.trim().replace(/\n{3,}/g,"\n\n")})(null!=(t=null==(e=p.data)?void 0:e.memory)?t:"")},[null==(n=p.data)?void 0:n.memory]);return{...p,data:p.data?{...p.data,memory:h}:p.data}},S=()=>{let{account:e,activeOrganization:t}=(0,s.YL)(),n=null==e?void 0:e.uuid,r=null==t?void 0:t.uuid,u=w(),{addError:d}=(0,a.Y)(),f=(0,m.A)(),p=(0,c.useQueryClient)(),{mutate:g,isPending:h}=(0,i.L2)("/api/organizations/".concat(r,"/memory/synthesize"),"POST",{enabled:!!t&&u,onSuccess:function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];let[s,a]=t;p.invalidateQueries({queryKey:[l.IX,{accountUUID:n,orgUUID:r,projectUUID:a.project_uuid}]})},onError:()=>{d((0,o.O)({id:"frigid_umbrella_sunflower",intl:f}))}});return{resynthesizeMemory:g,isResynthesizingMemory:h}},_=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid,n=w(),{addError:r}=(0,a.Y)(),u=(0,m.A)(),d=(0,c.useQueryClient)(),{mutate:f,isPending:p}=(0,i.L2)("/api/organizations/".concat(t,"/memory/reset"),"POST",{enabled:!!e&&n,onSuccess:()=>{d.invalidateQueries({queryKey:[l.IX]})},onError:()=>{r((0,o.O)({id:"frog_book_coffee",intl:u}))}});return{resetMemory:f,isResettingMemory:p}},x=function(){let{projectUUID:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,s.YL)(),r=null==t?void 0:t.uuid,u=null==n?void 0:n.uuid,d=w(),{addError:f,addSuccess:p}=(0,a.Y)(),g=(0,m.A)(),h=(0,c.useQueryClient)(),{mutate:v,isPending:y}=(0,i.Qv)("/api/organizations/".concat(u,"/memory/controls"),"PUT",(e,t)=>{var n;return{memory:null!=(n=null==t?void 0:t.memory)?n:"",controls:e.controls,updated_at:null==t?void 0:t.updated_at}},{queryKey:[l.IX,{accountUUID:r,orgUUID:u,projectUUID:e}],enabled:!!n&&d,onSuccess:()=>{p((0,o.O)({id:"serif_net_popcorn",intl:g})),h.invalidateQueries({queryKey:[l.IX,{accountUUID:r,orgUUID:u,projectUUID:e}]})},onError:e=>{f((0,o.O)({id:"frigid_umbrella_sunflower",intl:g}),{error:e})}});return{updateMemoryControls:v,updateMemoryControlsIsPending:y}},C=()=>{let{activeOrganization:e}=(0,s.YL)(),t=null==e?void 0:e.uuid,n=w(),r=t?"/api/organizations/".concat(t,"/memory/themes"):null;return(0,i.Sk)(r,{staleTime:3e5,enabled:!!t&&!!r&&n})},w=()=>{let{value:e}=(0,u.fS)("claudeai_saffron_enabled");return e},P=()=>{let{value:e}=(0,u.fS)("claudeai_saffron_admin_toggle_enabled"),t=w();return e&&!t},k=()=>{let e=w(),t=T();return e&&!!t},M=()=>{var e;let t=(0,s.mV)(),{data:n}=(0,h.rX)(),r=!!n&&!(null==(e=n.disabled_features)?void 0:e.includes("saffron"));return!t||r},T=()=>{var e;let t=M(),{account:n}=(0,s.YL)(),{value:r}=(0,u.fS)("claudeai_saffron_default_enabled");return!!t&&(null!=(e=null==n?void 0:n.settings.enabled_saffron)?e:r||void 0)},E=()=>{let{account:e}=(0,s.YL)(),{mutate:t}=(0,r.Jy)(),{resetMemory:n}=_();return(r,i)=>{t({...null==e?void 0:e.settings,enabled_saffron:r}),(null==i?void 0:i.shouldResetMemory)&&n()}},U=()=>{let{value:e}=(0,u.fS)("claudeai_saffron_search_enabled");return e},I=()=>{let{account:e}=(0,s.YL)(),t=(()=>{var e;let{account:t}=(0,s.YL)(),n=(()=>{let{value:e}=(0,u.fS)("claudeai_saffron_search_default_enabled");return e})();return null!=(e=null==t?void 0:t.settings.enabled_saffron_search)?e:n})(),n=U(),{mutate:i}=(0,r.Jy)(),{mutate:a}=(0,p.nI)(),o=(0,d.useRef)(null==e?void 0:e.settings);return(0,d.useEffect)(()=>{o.current=null==e?void 0:e.settings},[null==e?void 0:e.settings]),{toggleSaffronSearch:(0,d.useCallback)(e=>{i({...o.current,enabled_saffron_search:e}),n&&e&&a({})},[i,a,n]),saffronSearchEnabled:t}},j=()=>w(),A=()=>(0,u.T9)("claudeai_saffron_frontend","resynthesize_enabled",!1,u.Km),z=()=>(0,u.T9)("claudeai_saffron_frontend","max_num_controls",10,u.T2),O=()=>(0,u.T9)("claudeai_saffron_frontend","max_control_chars",100,u.T2)},74530:(e,t,n)=>{function r(e){return"text"===e.type&&e.text?{...e,text:e.text.replace("​","")}:e.content?{...e,content:e.content.map(r)}:e}n.d(t,{DV:()=>r,h0:()=>i});let i=e=>{let t="",n=0,r=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("doc"===e.type&&e.content)for(let t of e.content)r(t);else if("paragraph"===e.type){if(e.content)for(let t of e.content)r(t);t+="\n"}else if("text"===e.type){let n=e.text;if(e.marks)for(let t of e.marks)"bold"===t.type?n="**".concat(n,"**"):"italic"===t.type?n="*".concat(n,"*"):"underline"===t.type?n="__".concat(n,"__"):"strike"===t.type?n="~~".concat(n,"~~"):"code"===t.type&&(n="`".concat(n,"`"));t+=n}else if("codeBlock"===e.type){let n=e.attrs&&"string"==typeof e.attrs.language?e.attrs.language:"";if(t+="\n```".concat(n,"\n"),e.content)for(let t of e.content)r(t);t+="\n```\n\n"}else if("bulletList"===e.type&&e.content)for(let t of e.content)r(t);else if("orderedList"===e.type&&e.content)for(let t=0;t<e.content.length;t++)r(e.content[t],t+1,!0);else if("listItem"===e.type&&e.content){let a="   ".repeat(n);for(let o of(s?t+="".concat(a).concat(i,". "):t+="".concat(a,"* "),e.content))n+=1,r(o),n-=1}};return r(e),t.replace("​","").trim()}},75973:(e,t,n)=>{n.d(t,{d:()=>s}),n(54568),n(68096),n(1761),n(46127);var r=n(7620);let i=(0,r.createContext)({isInBeam:!1,beamUuid:void 0,beamConversationSettings:void 0,setBeamConversationSettings:void 0}),s=()=>(0,r.useContext)(i)},83092:(e,t,n)=>{n.d(t,{PerformanceMetricsProvider:()=>x,B:()=>C});var r=n(54568);class i extends Error{}class s{add(e){this.buffer[this.head]=e,this.head=(this.head+1)%this.maxSize,this.currentSize<this.maxSize&&this.currentSize++}addAll(e){for(let t of e)this.add(t)}flush(){this.head=0,this.currentSize=0,this.buffer=Array(this.maxSize)}get size(){return this.currentSize}get isEmpty(){return 0===this.currentSize}get isFull(){return this.currentSize===this.maxSize}*values(){if(0===this.currentSize)return;let e=this.isFull?this.head:0;for(let t=0;t<this.currentSize;t++){let n=(e+t)%this.maxSize;yield this.buffer[n]}}toArray(){return Array.from(this.values())}getLast(){if(0===this.currentSize)return;let e=(this.head-1+this.maxSize)%this.maxSize;return this.buffer[e]}getFirst(){if(0===this.currentSize)return;let e=this.isFull?this.head:0;return this.buffer[e]}constructor(e){if(this.maxSize=e,this.head=0,this.currentSize=0,e<1)throw new i("RingBuffer maxSize must be 1 or more");this.buffer=Array(e)}}var a=n(25099),o=n(27630),l=n(27062);let u={};var c=n(34762);let d={};var m=n(95199);let f="performance";function p(e,t){let{metricType:n=e.replace(/^.+?\./,""),duration:r=0,attributes:i={},performanceAttributes:s={},tracer:p=(!d.tracer&&(d.tracer=c.u.getTracer("claude-ai-performance","1.0.0")),d.tracer)}=t,g=m.C.getContextWithParent(),h=Date.now(),v=r>0?h-r:h,y=g?a._.with(g,()=>p.startSpan(e,{startTime:v})):p.startSpan(e,{startTime:v}),b="".concat(f,".").concat(n),S={...i,["".concat(f,".metric_type")]:n,...(0,o.r)(b,s),...function(){if(u.attributes)return u.attributes;let e=(0,l.Je)(),t=(0,o.r)("statsig",{smoother_optimization:!!(null==e?void 0:e.getExperiment("smoother_optimization").get("enabled",!1))});return e&&(u.attributes=t),t}()};r>0&&(S["".concat(b,".duration_ms")]=r,S.duration_ms=r),y.setAttributes(S),y.end(h)}class g{get mean(){return this.count>0?this._mean:0}get variance(){return this.count>1?this._m2/(this.count-1):0}get stdDev(){return Math.sqrt(this.variance)}calculate(){let e=this._tail-this._mean;this._mean+=e/this.count;let t=this._tail-this._mean;this._m2+=e*t}getSummary(){return{count:this.count,sum:this.sum,min:this.min,max:this.max,mean:this.mean,variance:this.variance,stdDev:this.stdDev}}reset(){this.count=0,this.sum=0,this.min=1/0,this.max=-1/0,this._mean=0,this._m2=0}add(e){this.count+=1,this.sum+=e,this.min=Math.min(this.min,e),this.max=Math.max(this.max,e),this._tail=e,this.calculate()}constructor(){this.count=0,this.sum=0,this.min=1/0,this.max=-1/0,this._tail=0,this._mean=0,this._m2=0,this.reset()}}class h{init(){if("PerformanceLongTaskTiming"in window)try{this.events.longTask.observer=this.initLongTaskObserver()}catch(e){console.error("PerfMon LongTaskObserver failed to init")}if("PerformanceEventTiming"in window)try{this.events.inputDelay.observer=this.initInputDelayObserver()}catch(e){console.error("PerfMon EventTimingObserver failed to init")}if("PerformanceLongAnimationFrameTiming"in window)try{this.events.longAnimationFrame.observer=this.initLongAnimationFrameObserver()}catch(e){console.error("PerfMon EventTimingObserver failed to init")}this.startReportMetricsInterval(),this.registerVisibilityHandlers()}initLongTaskObserver(){let e=new PerformanceObserver(e=>{for(let n of e.getEntries()){let{attribution:e}=n;if(this.events.longTask.stats.add(n.duration),n.duration>=250){var t;this.events.longTask.buffer.add({start_time:n.startTime,duration_ms:n.duration,attribution_count:null!=(t=null==e?void 0:e.length)?t:0})}}});return e.observe({entryTypes:["longtask"]}),e}initInputDelayObserver(){let e=new PerformanceObserver(e=>{for(let n of e.getEntries()){let e=n.processingStart?n.processingStart-n.startTime:0;if(e>100){this.events.inputDelay.stats.add(n.duration);let r=Number(n.processingEnd)-Number(n.processingStart);if(e>250||r>250){var t;this.events.inputDelay.buffer.add({start_time:n.startTime,duration_ms:e,processing_duration_ms:r,inp_duration_ms:n.duration,event_name:n.name,event_target_id:(null==(t=n.target)?void 0:t.id)||"unknown_target",is_fid:"first-input"===n.entryType})}}}});return e.observe({entryTypes:["event","first-input"]}),e}initLongAnimationFrameObserver(){let e=new PerformanceObserver(e=>{for(let t of e.getEntries()){let{blockingDuration:e}=t;if(this.events.longAnimationFrame.stats.add(t.duration),t.duration>=250){let n={start_time:t.startTime,duration_ms:t.duration,blocking_duration_ms:e||0};this.events.longAnimationFrame.buffer.add(n)}}});return e.observe({entryTypes:["long-animation-frame"]}),e}startReportMetricsInterval(){let e=()=>{this.reportMetricsTimeoutId=window.setTimeout(()=>{this.reportMetrics(),this.isActive&&e()},12e4)};e()}registerVisibilityHandlers(){document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.reportMetrics()},{passive:!0}),window.addEventListener("pagehide",()=>this.reportMetrics(),{passive:!0})}reportMetrics(){this.isActive&&Object.values(this.events).forEach(e=>{let{name:t,stats:n,buffer:r}=e;0!==n.mean&&(p("events.".concat(t,".summary"),{metricType:"".concat(t,"_summary"),performanceAttributes:{...n.getSummary()}}),r.toArray().forEach(e=>{let{duration_ms:n,...r}=e;p("events.".concat(t),{metricType:"".concat(t,"_event"),duration:n,performanceAttributes:{...r}})}),n.reset(),r.flush())})}destroy(){this.isActive=!1,Object.values(this.events).forEach(e=>{var t;null==(t=e.observer)||t.disconnect(),e.observer=void 0}),clearTimeout(this.reportMetricsTimeoutId),this.reportMetricsTimeoutId=void 0,this.reportMetrics()}forceReport(){this.reportMetrics()}constructor(){this.isActive=!0,this.events={longTask:{name:"long_task",stats:new g,buffer:new s(100)},inputDelay:{name:"input_delay",stats:new g,buffer:new s(100)},longAnimationFrame:{name:"loaf",stats:new g,buffer:new s(100)}},this.init()}}class v{initPerfMon(){this.perfMon||(this.perfMon=new h)}trackNewChatInputReady(e,t){p("page.new_chat_input_ready",{duration:e,attributes:{is_first_load:t}}),m.C.clearParentContext()}trackTTFT(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};t.model&&(n["chat.model"]=t.model),p("chat.time_to_first_token",{metricType:"ttft",duration:e,attributes:n})}trackProjectConversationsReady(e){p("page.project_conversations_ready",{duration:e})}trackMembersListReady(e){p("page.members_list_ready",{duration:e})}constructor(){this.perfMon=null}}let y=new v;var b=n(62942),S=n(7620);let _=(0,S.createContext)(null);function x(e){let{children:t}=e,n=(0,b.usePathname)(),i=(0,S.useRef)(!0),s=(0,S.useRef)(null),a=(0,S.useRef)(!1),o=(0,S.useRef)(null),l=(0,S.useRef)(!1),u=(0,S.useRef)(null),c=(0,S.useRef)(!1),d=(0,S.useRef)(null),m=(0,S.useRef)(!1);(0,S.useEffect)(()=>{y.initPerfMon()},[]),(0,S.useEffect)(()=>{"/new"===n?(s.current=i.current?0:performance.now(),a.current=!1):(null==n?void 0:n.startsWith("/project/"))?(u.current=performance.now(),c.current=!1):"/settings/members"===n&&(d.current=performance.now(),m.current=!1),i.current=!1},[n]);let f=(0,S.useCallback)(()=>{if(a.current||null===s.current)return;a.current=!0;let e=performance.now()-s.current;y.trackNewChatInputReady(e,0===s.current),s.current=null},[]),p=(0,S.useCallback)(()=>{o.current=performance.now(),l.current=!1},[]),g=(0,S.useCallback)(e=>{if(null===o.current||l.current)return;l.current=!0;let t=performance.now()-o.current;y.trackTTFT(t,e),o.current=null},[]),h=(0,S.useCallback)(()=>{if(c.current||null===u.current)return;c.current=!0;let e=performance.now()-u.current;y.trackProjectConversationsReady(e),u.current=null},[]),v=(0,S.useCallback)(()=>{if(m.current||null===d.current)return;m.current=!0;let e=performance.now()-d.current;y.trackMembersListReady(e),d.current=null},[]),x=(0,S.useMemo)(()=>({markEditorReady:f,markMessageSent:p,markFirstTokenReceived:g,markProjectConversationsReady:h,markMembersListReady:v}),[f,p,g,h,v]);return(0,r.jsx)(_.Provider,{value:x,children:t})}function C(){let e=(0,S.useContext)(_);if(!e)throw Error("usePerformanceMetrics must be used within a PerformanceMetricsProvider");return e}},89836:(e,t,n)=>{n.d(t,{EF:()=>g,NY:()=>m,Ql:()=>v,VA:()=>h,YO:()=>p,qJ:()=>f});var r=n(77186),i=n(1761),s=n(46612),a=n(71473),o=n(77101),l=n(87606),u=n(7620),c=n(91768),d=n(93049);let m=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,s=!!(t&&e.length>0),o=(0,u.useMemo)(()=>e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),[n,e]),l=(0,u.useMemo)(()=>({queryKey:e.map(e=>[a.GC,{orgUuid:n,syncSourceUuid:e}]),enabled:s,refetchInterval:e=>!!(e.state.data&&(0,c.z3)(e.state.data))&&5e3,meta:{noToast:!0}}),[s,n,e]);return(0,r._i)(o,l)},f=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,c.z3)(e.data)),p=e=>Math.ceil(m(e).reduce((e,t)=>{var n,r,i;return t.isLoading||!t.data?e:e+(null!=(i=null==(r=t.data)||null==(n=r.status)?void 0:n.current_size_bytes)?i:0)},0)/s.t2),g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,i.YL)(),s=null==t?void 0:t.uuid,u=null==n?void 0:n.uuid,m=(0,l.useQueryClient)(),f=(0,c.eL)();return(0,r.L2)(()=>"/api/organizations/".concat(u,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,r,i,l,c=arguments.length,d=Array(c),f=0;f<c;f++)d[f]=arguments[f];let[p]=d;m.setQueryData([a.GC,{orgUuid:u,syncSourceUuid:p.uuid}],p),p.type===o.v8.GDRIVE&&p.config.uri&&(null==(t=p.status)?void 0:t.extra)&&(null==(n=p.status)?void 0:n.current_size_bytes)&&m.setQueryData([a.QB,{accountUUID:s,orgUUID:u,documentId:p.config.uri}],{uri:"drive:///".concat(p.config.uri),title:null==(i=p.status)?void 0:i.extra,size:null==(l=p.status)?void 0:l.current_size_bytes}),null==(r=e.onSuccess)||r.call(e,...d)},onError:function(){for(var t,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];null==(t=e.onError)||t.call(e,...r);let[s,a]=r;f(s,a),a.sync_source_type===o.v8.GDRIVE&&(0,d.D8)(a.sync_source_config.uri)}})},h=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,s=(0,l.useQueryClient)();return(0,r.L2)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];let[l]=i;s.setQueryData([a.GC,{orgUuid:n,syncSourceUuid:l.uuid}],l),null==(t=e.onSuccess)||t.call(e,...i)}})},v=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},93049:(e,t,n)=>{n.d(t,{Ac:()=>s,D8:()=>o,bI:()=>a});let r="recentDriveDocs";function i(e){return"object"==typeof e&&null!==e&&"string"==typeof e.uri&&("string"==typeof e.title||void 0===e.title)}function s(e){localStorage.setItem(r,JSON.stringify(e))}function a(){if("undefined"==typeof localStorage)return[];let e=localStorage.getItem(r);if(e){let t=JSON.parse(e);if(t&&Array.isArray(t)&&t.every(i))return t}return[]}function o(e){let t=a();s(t=t.filter(t=>t.uri!==e))}},93770:(e,t,n)=>{n.d(t,{Fj:()=>m,Tc:()=>f,jM:()=>c,jw:()=>d,lE:()=>p});var r=n(7620),i=n(13368),s=n(98736),a=n(58004);let o=r.createContext(null),l=null;function u(e,t){let n=r.useContext(o)||(l||(l=(0,a.E)()),l);return(0,i.P)(n,(0,s.k)(e))}let c=o.Provider,d=()=>{let e=r.useContext(o),t=u(e=>e.conversation,"useChatInputConversationOnly");return e?t:void 0},m=()=>u(e=>({pendingConversationSettings:e.pendingConversationSettings,setPendingConversationSettings:e.setPendingConversationSettings}),"useChatInputPendingConversationSettings");function f(e,t){return u(e,t)}let p=()=>u(e=>({syncSourceUuids:e.syncSourceUuids,setSyncSourceUuids:e.setSyncSourceUuids,projectUuid:e.projectUuid,conversation:e.conversation}),"useChatInputSync")},95199:(e,t,n)=>{n.d(t,{C:()=>o});var r=n(34762),i=n(54430),s=n(25099);class a{extractFromServerTiming(){try{let e=performance.getEntriesByType("navigation");if(0===e.length)return;let t=e[0].serverTiming;if(!t)return;let n=t.find(e=>"traceparent"===e.name);if(!n||!n.description)return;let s=n.description.split("-");if(4!==s.length)return;let[a,o,l,u]=s;if("00"!==a)return;this.parentContext={traceId:o,spanId:l,traceFlags:parseInt(u,16),isRemote:!0};let c=r.u.wrapSpanContext(this.parentContext);this.contextWithParent=r.u.setSpan(i.l,c)}catch(e){}}setParentContext(e){this.parentContext=e}getParentContext(){return this.parentContext}isParentSampled(){return!!this.parentContext&&(1&this.parentContext.traceFlags)==1}getContextWithParent(){if(!this.parentContext)return null;let e=r.u.wrapSpanContext(this.parentContext);return r.u.setSpan(s._.active(),e)}clearParentContext(){this.parentContext=null,this.contextWithParent=null}hasParentContext(){return null!==this.parentContext}active(){return this.contextWithParent||i.l}with(e,t,n){for(var r=arguments.length,i=Array(r>3?r-3:0),s=3;s<r;s++)i[s-3]=arguments[s];return t.call(n,...i)}bind(e,t){return t}enable(){return this.initialized||(this.extractFromServerTiming(),this.initialized=!0),this}disable(){return this.parentContext=null,this.contextWithParent=null,this.initialized=!1,this}constructor(){this.initialized=!1,this.parentContext=null,this.contextWithParent=null}}let o=new a}}]);