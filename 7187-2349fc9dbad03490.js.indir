try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="38409935-bcaf-4c3d-b4a3-b9f9bfc89aa0",e._sentryDebugIdIdentifier="sentry-dbid-38409935-bcaf-4c3d-b4a3-b9f9bfc89aa0")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7187],{2341:(e,t,n)=>{n.d(t,{B:()=>s,N:()=>l});var a=n(54568),r=n(7620);let i=(0,r.createContext)(null),s=()=>{let e=(0,r.useContext)(i);return void 0===e?null:e},l=e=>{let{children:t,settings:n}=e;return(0,a.jsx)(i.Provider,{value:n,children:t})}},7726:(e,t,n)=>{n.d(t,{sk:()=>y,dy:()=>v,Rs:()=>z,Fn:()=>b,CW:()=>E,bT:()=>w,t7:()=>L,Vt:()=>T,WZ:()=>A,uE:()=>C,OZ:()=>N,O2:()=>O,mz:()=>f,FG:()=>D,Bq:()=>x,EV:()=>k,Lo:()=>U,_W:()=>S,yu:()=>j,HA:()=>M,HF:()=>q,Pt:()=>K,HI:()=>R,Du:()=>I,wR:()=>W,aC:()=>B,gG:()=>P,uC:()=>H,lj:()=>Y});var a=n(98518),r=n(77186),i=n(1761),s=n(2341),l=n(53248),o=n(71473),u=n(7620),c=n(75632),d=n(44180),h=n(87606),_=n(92012),p=n.n(_),m=n(62942),g=n(57067);let f=e=>{let t=(0,h.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,r=function(e){let t=JSON.stringify(e);return(0,u.useMemo)(()=>e,[t])}([o.fC,{orgUUID:a},{uuid:e}]);return t.getQueryData(r)},y=30,v=1e4,k=e=>{let{limit:t,offset:n,enabled:a=!0,starred:s,searchQuery:l}=e,{activeOrganization:u}=(0,i.YL)(),c=null==u?void 0:u.uuid,d=new URLSearchParams;void 0!==t&&d.append("limit",t.toString()),void 0!==n&&d.append("offset",n.toString()),void 0!==s&&d.append("starred",s.toString()),void 0!==l&&d.append("searchQuery",l);let h=d.toString();return h=h?"?".concat(h):"",(0,r.Sk)("/api/organizations/".concat(null!=c?c:"","/chat_conversations").concat(h),{queryKey:[o.DC,{orgUUID:c},{limit:t,offset:n,starred:s,searchQuery:l}],staleTime:3e5,enabled:!!c&&a})},b=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/chat_conversations/count_all"),{queryKey:[o.Ad,{orgUUID:t}],staleTime:3e5,enabled:!!t})},C=()=>{let{activeOrganization:e}=(0,i.YL)(),t=(0,r.mn)();return(0,u.useCallback)(async n=>{let{limit:a,offset:r}=n,i=new URLSearchParams;void 0!==a&&i.append("limit",a.toString()),void 0!==r&&i.append("offset",r.toString());let s=i.toString();return s=s?"?".concat(s):"",(await t("/api/organizations/".concat(null==e?void 0:e.uuid,"/chat_conversations").concat(s))).json()},[null==e?void 0:e.uuid,t])},x=function(e){let{suppressError:t,enabled:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{enabled:!0},{activeOrganization:a}=(0,i.YL)(),s=null==a?void 0:a.uuid,l=(0,u.useRef)([]),c=(0,h.useQueryClient)(),d="/api/organizations/".concat(null!=s?s:"","/chat_conversations/").concat(e,"?tree=True&rendering_mode=messages&render_all_tools=true"),_=(0,r.Sk)(d,{queryKey:[o.fC,{orgUUID:s},{uuid:e}],staleTime:3e5,enabled:!!s&&!!e&&n,meta:{noToast:t}},t=>(c.invalidateQueries({queryKey:[o.XF,{orgUUID:s,conversationUUID:e}]}),(0,g.H6)(t))),m=(0,u.useMemo)(()=>{if(!_.data)return l.current=[],l.current;let e=(0,g.$)(_.data);if(e.length!==l.current.length||e.some((e,t)=>{var n;return e.uuid!==(null==(n=l.current[t])?void 0:n.uuid)}))return l.current=e,l.current;for(let t=0;t<e.length;t++)p()(e[t],l.current[t])||(l.current[t]=e[t]);return l.current},[_.data]);return{..._,currentPath:m}},S=e=>{let t=(0,h.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid;return(0,u.useCallback)(()=>{t.invalidateQueries({queryKey:[o.fC,{orgUUID:a},{uuid:e}]})},[t,a,e])},w=(e,t)=>{let{mutateAsync:n}=E(),a=(0,m.useRouter)(),r=t||(0,c.N)();return(0,u.useCallback)(function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{model:void 0,controlsOpen:!1},i={uuid:r,name:"",model:t.model};t.createMode&&(i.create_mode=t.createMode),t.projectUuid&&(i.project_uuid=t.projectUuid),n(i).then(()=>{let n="/chat/".concat(r).concat(t.controlsOpen?"?controls=1":"");a[e](n)}).catch(e=>{(0,d.Cp)(e)})},[n,a,e,r])},E=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,h.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(null!=t?t:"","/chat_conversations"),"POST",{enabled:!!t,onSuccess:e=>{let a;n.setQueryData((a=e.uuid,[o.fC,{orgUUID:t},{uuid:a}]),t=>({...t||{},...e,chat_messages:(null==t?void 0:t.chat_messages)||[],messageByUuid:new Map,parentByChildUuid:new Map,childrenByParentUuid:new Map,selectedChildByUuid:new Map}))}})},L=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid,n=(0,h.useQueryClient)();return(0,r.Qv)(e=>{let{uuid:n}=e;return"/api/organizations/".concat(null!=t?t:"","/chat_conversations/").concat(n)},"DELETE",(e,t)=>{let{uuid:n}=e;if(!t)return[];let a=t.findIndex(e=>e.uuid===n);if(!(a>-1))return t;{let e=[...t];return e.splice(a,1),e}},{enabled:!!t,queryKey:[o.DC,{orgUUID:t}],onSuccess:async(e,a)=>{let{uuid:r,projectUuid:i}=a;await n.invalidateQueries({queryKey:[o.fC,{orgUUID:t},{uuid:r}]}),i&&await n.invalidateQueries({queryKey:[o.yF,{orgUuid:t,projectUuid:i}]}),await F(n,t)}})},T=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,h.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/delete_many"),"POST",{onSuccess:async t=>{await F(a,n),e&&e(t)}})},j=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/shares"),{queryKey:[o._J,{orgUUID:t}],enabled:!!t,staleTime:3e5})},O=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/latest"),{enabled:!!n&&!!e,queryKey:[o.XF,{orgUUID:n,conversationUUID:e}],staleTime:0,meta:{noToast:!0}},e=>{let{snapshot:t,shareable:n,disabled_reason:a}=e;return{shareable:n,disabled_reason:a,snapshot:t?{...t,chat_messages:t.chat_messages.map(e=>(0,g.XU)(e))}:null}})},D=e=>{let{activeOrganization:t,account:n}=(0,i.YL)(),a=null==t?void 0:t.uuid,s=n&&a?"/api/organizations/".concat(a,"/chat_snapshots/").concat(e,"?rendering_mode=messages&render_all_tools=true"):"/api/chat_snapshots/".concat(e,"?rendering_mode=messages&render_all_tools=true");return(0,r.Sk)(s,{retry:!1,refetchInterval:!1,enabled:!!e,staleTime:0,queryKey:[o.Bn,{orgUUID:a,snapshotUUID:e}]},e=>({...e,chat_messages:e.chat_messages.map(e=>(0,g.XU)(e))}))},I=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,h.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/share"),"POST",{onSuccess:()=>{a.invalidateQueries({queryKey:[o.XF,{orgUUID:n,conversationUUID:e}]}),a.invalidateQueries({queryKey:[o._J,{orgUUID:n}]}),a.invalidateQueries({queryKey:[o.A2,{orgUUID:n}]})}})},P=(e,t)=>{let{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,s=(0,h.useQueryClient)();return(0,r.L2)("/api/organizations/".concat(a,"/share/").concat(t),"DELETE",{enabled:!!a&&!!t,meta:{errorMessage:"There was an error while trying to unshare the conversation. Please try again."},onSuccess:()=>{s.invalidateQueries({queryKey:[o.XF,{orgUUID:a,conversationUUID:e}]}),s.invalidateQueries({queryKey:[o._J,{orgUUID:a}]}),s.invalidateQueries({queryKey:[o.A2,{orgUUID:a}]})}})},U=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.Sk)("/api/organizations/".concat(n,"/artifact-versions/").concat(e),{retry:!1,refetchInterval:!1,enabled:!!e&&!!n,staleTime:0,queryKey:[o.Fz,{artifactVersionUUID:e}]})},M=function(e,t,n){var l,u,c;let d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{track:_}=(0,a.st)(),p=null!=(u=null==(l=(0,s.B)())?void 0:l.preview_feature_uses_artifacts)&&u,{activeOrganization:m}=(0,i.YL)(),g=null==m?void 0:m.uuid,f=(0,h.useQueryClient)(),y=[o.fC,{orgUUID:g},{uuid:e}];return(0,r.L2)("/api/organizations/".concat(null!=g?g:"","/chat_conversations/").concat(e,"/chat_messages/").concat(null!=(c=t.uuid)?c:"","/chat_feedback"),t.chat_feedback?"PUT":"POST",{enabled:!!g,meta:{errorMessage:"We could not save your feedback. Please try again later."},...d,onSuccess(){for(var a,r,i=arguments.length,s=Array(i),l=0;l<i;l++)s[l]=arguments[l];_({event_key:"claudeai.conversation.feedback.sent",message_uuid:t.uuid,conversation_uuid:e,artifacts_enabled:p,conversationHasArtifacts:n,type:null==(a=t.chat_feedback)?void 0:a.type}),f.invalidateQueries({queryKey:y}),null==(r=d.onSuccess)||r.call(d,...s)}})},Q=()=>{let e=(0,h.useQueryClient)(),{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,u.useCallback)((t,a)=>{t&&(e.setQueryData([o.fC,{orgUUID:n},{uuid:t}],e=>e&&{...e,...a}),e.setQueriesData({queryKey:[o.DC,{orgUUID:n}]},e=>null==e?void 0:e.map(e=>e.uuid!==t?e:{...e,...a})))},[n,e])},R=e=>{let t=(0,h.useQueryClient)(),{activeOrganization:n}=(0,i.YL)(),a=null==n?void 0:n.uuid,s=Q();return(0,r.L2)("/api/organizations/".concat(a,"/chat_conversations/").concat(e),"PUT",{onMutate:n=>{var r;let{name:i}=n,l=t.getQueryData([o.fC,{orgUUID:a},{uuid:e}]);return s(e,{name:i}),{oldTitle:null!=(r=null==l?void 0:l.name)?r:""}},onError(t,n,a){a&&s(e,{name:a.oldTitle})}})},A=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=Q();return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/model_fallback"),"PUT",{onSuccess:t=>{a(e,{model:t.model})}})},N=e=>{let t=Q(),{activeOrganization:n}=(0,i.YL)();return(0,r.L2)("/api/organizations/".concat(null==n?void 0:n.uuid,"/chat_conversations/").concat(e,"/title"),"POST",{onSuccess(n){let{title:a}=n;t(e,{name:null!=a?a:""})},meta:{noToast:!0}})};function z(e){var t,n;let a=(0,l.C)(e),r=e.attachments.map(e=>e.extracted_content).join(" ");return a+" "+r+" "+((null==(t=e.content)?void 0:t.filter(e=>"tool_use"===e.type).map(e=>e.input?JSON.stringify(e.input):e.partial_json||"").join(" "))||"")+" "+((null==(n=e.content)?void 0:n.filter(e=>"tool_result"===e.type).flatMap(e=>e.content.filter(e=>"text"===e.type).map(e=>e.text)).join(" "))||"")}let B=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/stop_response"),"POST")},K=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.L2)(e=>{let{conversation_uuid:n}=e;return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/tool_result")},"POST",{enabled:!!t,meta:{errorMessage:"We could not record the tool result. Please try again later."},transformVariables:e=>{let{conversation_uuid:t,...n}=e;return n}})},Y=e=>{let{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid;return(0,r.L2)("/api/organizations/".concat(n,"/chat_conversations/").concat(e,"/current_leaf_message_uuid"),"PUT")},q=(e,t)=>{let{activeOrganization:n}=(0,i.YL)(),a=(0,h.useQueryClient)(),s=null==n?void 0:n.uuid;return(0,r.Qv)("/api/organizations/".concat(s,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,settings:{...t.settings,...e.settings}}:void 0,{enabled:!!e,onSuccess:()=>{F(a,s)},onSettled:()=>{(null==t?void 0:t.refetchOnSettled)&&a.refetchQueries({queryKey:[o.fC,{orgUUID:s},{uuid:e}]})},queryKey:[o.fC,{orgUUID:s},{uuid:e}]})},F=async(e,t)=>{await Promise.all([e.invalidateQueries({queryKey:[o.DC,{orgUUID:t}]}),e.invalidateQueries({queryKey:[o.Ad,{orgUUID:t}]})])},W=e=>{let{activeOrganization:t}=(0,i.YL)(),n=(0,h.useQueryClient)(),a=null==t?void 0:t.uuid;return(0,r.Qv)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>t?{...t,...e}:void 0,{onSuccess:()=>{F(n,a)},queryKey:[o.fC,{orgUUID:a},{uuid:e}]})},H=e=>{let{activeOrganization:t}=(0,i.YL)(),n=(0,h.useQueryClient)(),a=null==t?void 0:t.uuid;return(0,r.Qv)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"?rendering_mode=raw"),"PUT",(e,t)=>{var n;return t?{...t,project_uuid:null!=(n=e.project_uuid)?n:void 0}:void 0},{onSuccess:()=>{F(n,a),n.invalidateQueries({queryKey:[o.yF]})},queryKey:[o.fC,{orgUUID:a},{uuid:e}]})}},8974:(e,t,n)=>{n.d(t,{Z:()=>r});class a{setVisibilityCheck(e){this.checkFn=e}clearVisibilityCheck(){this.checkFn=null}isVisible(){return!this.checkFn||this.checkFn()}constructor(){this.checkFn=null}}let r=new a},17936:(e,t,n)=>{n.d(t,{W:()=>c});var a=n(54568),r=n(10158),i=n(1761),s=n(27261),l=n.n(s),o=n(62971);let u=()=>{let e=(0,r.fZ)(),{websiteBaseUrl:t}=(0,r._r)();return e?(0,a.jsx)(o.A,{defaultMessage:"Or consider <link>upgrading to Claude Pro</link>.",id:"j0jOXOpUyS",values:{link:e=>(0,a.jsx)("a",{href:"/upgrade/pro",className:"font-bold underline",rel:"noreferrer",children:e})}}):(0,a.jsx)(o.A,{defaultMessage:"Or <link>contact sales</link> if you would be interested in upgrading to a paid version of Claude.",id:"3hk4yMCf5v",values:{link:e=>(0,a.jsx)(l(),{href:"".concat(t,"/contact-sales"),className:"font-bold underline",children:e})}})};function c(){let e=(0,i.UC)(),t=(0,i.r$)();return e&&!t?(0,a.jsx)(u,{}):null}},18483:(e,t,n)=>{n.d(t,{SC:()=>c,UW:()=>l,Xn:()=>s,ey:()=>o,lK:()=>u});var a=n(29098),r=n.n(a),i=n(40459);r().join(i.cwd(),"public/i18n"),r().join(i.cwd(),"public/i18n/secret");let s="en-US",l={"xx-LS":{name:"Long stringsSSSSSSSS"},"xx-AC":{name:"ALL CAPS"},"xx-HA":{name:"[javascript] prefixed strings"},"en-XA":{name:"Ȧȧƈƈḗḗƞŧḗḗḓ Ḗḗƞɠŀīīşħ"},"en-XB":{name:"ɥsıʅƃuƎ ıpıԐ"}};function o(e){return"".concat("secret",":").concat(e)}function u(e){return"".concat("statsig",":").concat(e)}Object.keys(l);let c=["en-US","de-DE","fr-FR","ko-KR","ja-JP","es-419","es-ES","it-IT","hi-IN","pt-BR","id-ID"]},19303:(e,t,n)=>{n.d(t,{G:()=>c});var a=n(7726),r=n(1761),i=n(71473),s=n(87606),l=n(7620),o=n(57067),u=n(80079);let c=(e,t)=>{let n=(0,s.useQueryClient)(),{activeOrganization:c}=(0,r.YL)(),d=null==c?void 0:c.uuid,h=(0,l.useRef)(void 0),_=(0,u.$)(),p=(0,l.useCallback)(async(e,t)=>{let a=[i.fC,{orgUUID:d},{uuid:e}],r=n.getQueryData(a);if(!r)throw Error("Conversation tree must be provided for append");h.current=t(r),await n.cancelQueries({queryKey:a}),n.setQueryData(a,h.current)},[n,d]),m=(0,l.useRef)(new Set),g=(0,l.useCallback)((a,r)=>{if(0!==r.length){if(e&&!m.current.has(a)&&r.some(e=>"text"===e.type&&e.text&&e.text.trim().length>0)&&(m.current.add(a),e()),t){var s,l;t(null!=(l=null==(s=h.current)?void 0:s.uuid)?l:"",a,r);return}n.setQueryData([i.fC,{orgUUID:d},{uuid:a}],()=>{let e=h.current;if(!e)throw Error("Conversation tree must be provided for incremental completion");if(!e.current_leaf_message_uuid)throw Error("Couldn't figure out where to put completion");let t=e.messageByUuid.get(e.current_leaf_message_uuid);if(!t)throw Error("New assistant message not found");return t.content=r,{...e,created_at:new Date().toISOString()}})}},[n,d,e,t]);return{onStartAppend:p,onStreamCompleted:(0,l.useCallback)((e,t)=>{n.invalidateQueries({queryKey:[i.fC,{orgUUID:d}]}),n.invalidateQueries({queryKey:["FEATURE_LIMITS",d]});let r=h.current,s=(null==r?void 0:r.chat_messages)&&r.chat_messages.length<=2;r&&s&&!r.is_temporary&&(n.setQueriesData({queryKey:[i.DC,{orgUUID:d}],predicate:e=>{let{queryKey:t}=e,n=t[2];return!(null==n?void 0:n.starred)}},t=>!t||t.some(t=>t.uuid===e)?t:[{uuid:e,name:r.name,summary:r.summary,updated_at:r.updated_at,created_at:r.created_at,project_uuid:r.project_uuid,model:r.model,settings:r.settings,is_starred:!1},...t].slice(0,a.sk)),n.setQueryData([i.Ad,{orgUUID:d}],e=>{var t;return{is_first_conversation:!1,count:(null!=(t=null==e?void 0:e.count)?t:0)+1}})),t&&d&&_(t,d,e)},[n,_,d]),onIncrementalCompletion:g,changeDisplayedConversationPath:(0,l.useCallback)((e,t,a,r)=>{n.setQueryData([i.fC,{orgUUID:d},{uuid:e}],e=>{if(!e)throw Error("Conversation tree must be provided for changeDisplayedConversationPath");let n=(0,o.gX)(e,t,a);return n.current_leaf_message_uuid&&r&&r(n.current_leaf_message_uuid),n})},[n,d])}}},31198:(e,t,n)=>{n.d(t,{v:()=>i,x:()=>s});var a=n(7620);let r="customSystemPrompt",i=()=>{let[e,t]=(0,a.useState)(()=>"undefined"==typeof localStorage?"":localStorage.getItem(r)||"");return(0,a.useEffect)(()=>{localStorage.setItem(r,e)},[e]),{customSystemPrompt:e,setCustomSystemPrompt:t}},s=()=>"undefined"==typeof localStorage?"":localStorage.getItem(r)},53248:(e,t,n)=>{n.d(t,{C:()=>a});let a=e=>{let t="";if(e.content)for(let n of e.content)"text"===n.type&&(t+=n.text);return t}},55554:(e,t,n)=>{n.d(t,{TierSelectorProvider:()=>d,t:()=>c});var a=n(54568),r=n(46612),i=n(27062),s=n(85544),l=n(7620),o=n(96712);let u=(0,l.createContext)(null),c=()=>{let e=(0,l.useContext)(u);if(!e)throw Error("useTierSelector must be used within a TierSelectorProvider");return e},d=e=>{var t;let{children:n,initialEnabled:c=!1}=e,d=(0,o.l)(),[h,_]=(0,l.useState)(()=>d.get(r.eT.SELECTED_TIER)||null),[p,m]=(0,l.useState)(()=>"true"===d.get(r.eT.SHOULD_OVERRIDE_TOKEN_LIMITS)),[g,f]=(0,l.useState)(()=>"true"===d.get(r.eT.SHOULD_OVERRIDE_FEATURE_ACCESS)),y=null!=(t=(0,i.fS)("internal_tier_selector").value)?t:c,v=(0,l.useState)(y)[1],k=(0,l.useCallback)(()=>{let e=[s.d7.FREE,s.d7.PRO,s.d7.ENTERPRISE,s.d7.MAX],t=Math.floor(Math.random()*e.length);return e[t]},[]),b=(0,l.useCallback)(e=>{if(!y)return void _(e);if(null===e){let e=h||k();d.set(r.eT.SELECTED_TIER,e,{maxAgeSeconds:2592e3})}else d.set(r.eT.SELECTED_TIER,e);_(e)},[h,_,d,k,y]);(0,l.useEffect)(()=>{y?h&&d.set(r.eT.SELECTED_TIER,h):d.delete(r.eT.SELECTED_TIER)},[y,h,d]);let C=(0,l.useCallback)(e=>{if(!y)return void m(e);e?d.set(r.eT.SHOULD_OVERRIDE_TOKEN_LIMITS,"true"):d.delete(r.eT.SHOULD_OVERRIDE_TOKEN_LIMITS),m(e)},[y,d]),x=(0,l.useCallback)(e=>{if(!y)return void f(e);e?d.set(r.eT.SHOULD_OVERRIDE_FEATURE_ACCESS,"true"):d.delete(r.eT.SHOULD_OVERRIDE_FEATURE_ACCESS),f(e)},[y,d]);return(0,l.useEffect)(()=>{y||(d.delete(r.eT.SHOULD_OVERRIDE_TOKEN_LIMITS),d.delete(r.eT.SHOULD_OVERRIDE_FEATURE_ACCESS))},[y,d]),(0,a.jsx)(u.Provider,{value:{selectedTier:h,isTierSelectorEnabled:y,setSelectedTier:b,setIsTierSelectorEnabled:v,shouldOverrideTokenLimits:p,setShouldOverrideTokenLimits:C,shouldOverrideFeatureAccess:g,setShouldOverrideFeatureAccess:x},children:n})}},57067:(e,t,n)=>{n.d(t,{$:()=>g,AP:()=>d,GN:()=>u,Gp:()=>c,H6:()=>_,Rh:()=>l,XU:()=>h,ZQ:()=>p,gF:()=>o,gX:()=>f,gv:()=>s,xQ:()=>m});var a=n(44180),r=n(6363),i=n.n(r);let s="new-assistant-message-uuid",l="new-human-message-uuid",o="00000000-0000-4000-8000-000000000000",u=e=>!e.startsWith(s);function c(e,t){let n=e.get(t);if(void 0===n){let e=Error("Key not found: ".concat(t));throw(0,a.Cp)(e),e}return n}let d=(e,t)=>{let n=null!=t?t:e.current_leaf_message_uuid;if(!n)return e;for(;n!==o;){var a;let t=c(e.parentByChildUuid,n),r=null==(a=c(e.childrenByParentUuid,t))?void 0:a.indexOf(n);e.selectedChildByUuid.set(t,r),n=t}return{...e,current_leaf_message_uuid:t}},h=e=>e.content?e:{...e,content:[{type:"text",text:e.text||"",citations:[]}]},_=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=new Set;for(let t of e.chat_messages)"assistant"===t.sender&&t.parent_message_uuid&&n.add(t.parent_message_uuid);let a=e.chat_messages.filter(e=>"assistant"===e.sender||n.has(e.uuid)||void 0===e.parent_message_uuid||t),r={...e,chat_messages:a},i={...r,...(e=>{var t,n,a;let r=new Map,i=new Map,s=new Map,l=new Map,u=new Map;if(0===e.chat_messages.length)return{messageByUuid:i,parentByChildUuid:s,childrenByParentUuid:l,selectedChildByUuid:u};let c=e.chat_messages.map(h);for(let e of c)r.set(e.index,e),i.set(e.uuid,e);for(let e of c){let t=e.parent_message_uuid;if(!t){let a=e.index-1;for(;!t&&a>=0;)t=null==(n=r.get(a))?void 0:n.uuid,a--}t=null!=t?t:o,s.set(e.uuid,t),l.set(t,(null!=(a=l.get(t))?a:[]).concat(e.uuid)),u.set(t,0)}if(!(null==(t=l.get(o))?void 0:t[0]))throw Error("No root message found");return{chat_messages:c,messageByUuid:i,parentByChildUuid:s,childrenByParentUuid:l,selectedChildByUuid:u}})(r)};return i.current_leaf_message_uuid||d(i),d(i,r.current_leaf_message_uuid)},p=e=>{let t=Array.from(e.messageByUuid.values()).map(e=>e.index);return 0===t.length?-1:Math.max(...t)},m=(e,t)=>{for(let a of(e.chat_messages=e.chat_messages.concat(t),t)){var n;if(!a.parent_message_uuid)throw Error("Parent UUID required");let t=a.parent_message_uuid;e.messageByUuid.set(a.uuid,a),e.parentByChildUuid.set(a.uuid,t);let r=null!=(n=e.childrenByParentUuid.get(t))?n:[];r.push(a.uuid),e.childrenByParentUuid.set(t,r),e.selectedChildByUuid.set(t,r.length-1)}return d(e,t[t.length-1].uuid)},g=(e,t)=>{let n=[],a=null!=t?t:o;for(;e.childrenByParentUuid.has(a);){let t=c(e.childrenByParentUuid,a);if(0===t.length)break;let r=c(e.selectedChildByUuid,a),i=c(e.messageByUuid,t[r]);n.push({...i,parent_message_uuid:a,nOptions:t.length,selectedOption:r}),a=i.uuid}return n};function f(e,t,n){var a;let r=c(e.parentByChildUuid,t.uuid),s=c(e.childrenByParentUuid,r),l=i()((null!=(a=t.selectedOption)?a:0)+n,0,s.length-1);e.selectedChildByUuid.set(r,l);let o=g(e,r);return d(e,o[o.length-1].uuid)}},66442:(e,t,n)=>{n.d(t,{ep:()=>_,OZ:()=>h,xD:()=>m});var a=n(29585),r=n(8035),i=n(72034),s=n(44180);let l=(e,t,n)=>{let{blockSize:a,sliceBlock:r}=e,i=[];if(n<=0)return[];let s=0;for(let e of t){if(s+a(e)>=n){i.push(r(e,n-s));break}i.push(e),s+=a(e)}return i},o=1e3/60;class u{_get_smoothed_completion(){var e,t,n;if(0===this.start)return[];if(this.x>=this.totalCompletionLength)return this.smoothed_completion_is_unchanged=!0,l(this.blockOperations,this.blocksList,this.totalCompletionLength);let a=(Date.now()-this.start)/1e3,r=this.arrivals[this.arrivals.length-1][1]+(this.model_done||this.force_smoother_done?100:0),i=.9*a-(null!=(n=null==(e=(t=this.blockOperations).getBlockDeadlineOffset)?void 0:e.call(t))?n:.3),s=this.arrivals.filter(e=>e[0]<i).map(e=>e[1]),o=s[s.length-1],u=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let r=e(t),i=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(r>a)throw Error("Lower f is greater than zero");if(i<-a)throw Error("Upper f is less than zero");for(;r<-a;){let a=(t+n)/2,s=e(a);s<=0?(t=a,r=s):(n=a,i=s)}return t}(e=>{let t=(e-this.x)/(a-this.t),n=1/(a-this.t);return 2*(this.force_smoother_done?.01*this.gamma:this.gamma)*n*(t-this.v)-1/(e-o)+1/(r-e)},o,r),c=(u-this.x)/(a-this.t);return this.v=this.alpha*this.v+(1-this.alpha)*c,this.smoothed_completion_is_unchanged=this.x>=this.totalCompletionLength,this.x=Math.max(u,this.x),this.t=a,this.stats.push({t:a,x:u,v:c,min_chars:o,max_chars:r}),l(this.blockOperations,this.blocksList,this.x)}get smootherDone(){return this.force_smoother_done||this.model_done&&this.x>=this.totalCompletionLength}addBlock(e,t){this.blocksList.push(t)}updateBlock(e,t){this.blocksList[e]=t}getBlocks(){return this.blocksList}onMessage(e){let t;switch(e.type){case"content_block_start":{let t=this.blockOperations.createBlockFromStartEvent(e);null!==t&&this.addBlock(e.index,t);break}case"content_block_delta":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.applyDeltaEvent(e,t);this.updateBlock(e.index,n);break}case"content_block_stop":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.stopBlockEvent(e,t);this.updateBlock(e.index,n);break}case"message_stop":this.model_done=!0}0===this.start&&(this.start=Date.now());let n=(t=this.blockOperations,this.blocksList.reduce((e,n)=>e+t.blockSize(n),0));if(this.totalCompletionLength=n,this.arrivals.push([(Date.now()-this.start)/1e3,n]),this.dont_smooth&&this.on_completion){let e=structuredClone(this.blocksList);this.on_completion(e)}}async task(e,t){for(;!this.smootherDone&&!t.aborted;){if(document.hidden){await new Promise(e=>setTimeout(e,200));continue}if(this.x>=this.totalCompletionLength&&this.model_done)break;if(this.blocksList.length>0){let t=this._get_smoothed_completion();this.smoothed_completion_is_unchanged||e(t)}let t=!0;if(this.checkVisibility){let e=Date.now();e-this.lastVisibilityCheck>1e3&&(this.cachedVisibility=this.checkVisibility(),this.lastVisibilityCheck=e),t=this.cachedVisibility}let n=t?o:100;await new Promise(e=>setTimeout(e,n))}}constructor(e){this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.totalCompletionLength=0,this.smoothed_completion_is_unchanged=!1,this.dont_smooth=!1,this.model_done=!1,this.force_smoother_done=!1,this.stats=[],this.blocksList=[],this.lastVisibilityCheck=0,this.cachedVisibility=!0,this.blockOperations=e}}var c=n(8974);let d=null,h=()=>{d&&(d.force_smoother_done=!0)};var _=function(e){return e[e.APPEND_MESSAGE_WITH_COMPLETION=1]="APPEND_MESSAGE_WITH_COMPLETION",e[e.RETRY_MESSAGE_WITH_COMPLETION=2]="RETRY_MESSAGE_WITH_COMPLETION",e}({});let p=["close_file","create_file","delete_file","file_search","open_file","repl","str_replace","update_file"];async function m(e){let t,n,{applicationType:l,endpoint:o,orgUuid:h,conversationUuid:_,body:m,onCompletion:g,onInvokeTool:f,abortController:y,completion:v,getTools:k,smoothingEnabled:b=!0}=e,C=function(){let e=new Map,t=!1;return new u({blockSize:e=>{if("text"===e.type)return e.text.length;if("thinking"===e.type)return e.thinking.length;if("tool_use"===e.type){var t;return(null==(t=e.partial_json)?void 0:t.length)||0}return e.type,0},sliceBlock:(e,t)=>{if("tool_result"===e.type)return e;if("text"===e.type)return{...e,text:e.text.slice(0,t)};if("tool_use"===e.type){var n;return{...e,partial_json:null==(n=e.partial_json)?void 0:n.slice(0,t)}}return"thinking"===e.type?{...e,thinking:e.thinking.slice(0,t)}:e},createBlockFromStartEvent:e=>("thinking"===e.content_block.type&&(e.content_block.start_timestamp=new Date().toISOString()),e.content_block),applyDeltaEvent:(n,a)=>{switch(a.type){case"text":switch(t=!1,n.delta.type){case"text_delta":return{...a,text:a.text+n.delta.text};case"citation_start_delta":{let t=n.delta.citation;return e.set(t.uuid,{...t,start_index:a.text.length}),a}case"citation_end_delta":{let t=n.delta.citation_uuid,r=e.get(t);if(!r)return a;let i=a.citations?[...a.citations]:[];return i.push({...r,end_index:a.text.length}),{...a,citations:i}}default:return a}case"thinking":switch(t=!0,n.delta.type){case"thinking_delta":return{...a,thinking:a.thinking+n.delta.thinking};case"thinking_summary_delta":return{...a,summaries:[...a.summaries||[],n.delta.summary]};case"thinking_cut_off_delta":return{...a,cut_off:n.delta.cut_off};default:return a}case"tool_result":if(t=!1,"input_json_delta"===n.delta.type)return{...a,content:[{type:"text",text:n.delta.partial_json}]};return a;case"tool_use":var r;if(t=!1,"input_json_delta"!==n.delta.type)return a;return{...a,partial_json:(null!=(r=a.partial_json)?r:"")+n.delta.partial_json}}},stopBlockEvent:(e,t)=>{if("thinking"===t.type)return{...t,stop_timestamp:e.stop_timestamp};if("tool_use"===t.type){var n;return{...t,buffered_input:null!=(n=e.buffered_input)?n:"{}"}}return t},getBlockDeadlineOffset(){if(t)return 3}})}();d=C,C.dont_smooth=!b,C.on_completion=g,C.checkVisibility=()=>c.Z.isVisible();let x=b?C.task(g,y.signal):Promise.resolve(),S={"Content-Type":"application/json",Accept:"text/event-stream",...(0,r._)(l)},w=null,E=null,L=JSON.stringify({...v,...m,text:void 0,rendering_mode:"messages",organization_uuid:void 0,conversation_uuid:void 0}),T="",j="",O="",D=0,I=(0,i.y)(function(e,t,n){let a;if(void 0===t||void 0===n)throw Error("Missing org uuid or conversation uuid");switch(e){case 1:a="completion";break;case 2:a="retry_completion";break;default:throw Error("Invalid endpoint")}return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/").concat(a)}(o,h,_),{method:"POST",credentials:"include",headers:S,body:L,openWhenHidden:!0,signal:y.signal,async onopen(e){var t;if(!e.ok||!(null==(t=e.headers.get("content-type"))?void 0:t.includes(i.o))){let t=await e.text(),n={};try{n=JSON.parse(t)}catch(e){}throw(0,a.a5)(e.status,n,"Failed to fetch",e.headers)}},onmessage:e=>{var r,i;switch(e.event){case"ping":default:return;case"error":throw(0,a.a5)(0,JSON.parse(e.data),"Streaming error: 22");case"completion":{let t=JSON.parse(e.data);if(void 0===t.completion)throw Error("Unexpected message received when streaming: ".concat(e.data));let n={type:"content_block_delta",index:0,delta:{type:"text_delta",text:t.completion}};w=t.stop_reason,E=null!=(r=t.messageLimit)?r:null,C.onMessage(n);break}case"content_block_start":{let a=JSON.parse(e.data);D=a.index,"tool_use"===a.content_block.type&&(j=a.content_block.name,O=a.content_block.id,t=a.content_block.approval_options,n=a.content_block.approval_key),C.onMessage(a);break}case"content_block_delta":{let t=JSON.parse(e.data);if(t.index!==D&&"thinking_summary_delta"!==t.delta.type)throw Error("Content block index did not match the expected index");(null==(i=t.delta)?void 0:i.type)==="input_json_delta"&&(p.includes(j)||k().some(e=>e.name===j||j.endsWith(":".concat(e.name)))||n)&&(T+=t.delta.partial_json),C.onMessage(t);break}case"content_block_stop":{let a=JSON.parse(e.data);if(a.index!==D)throw Error("Content block index did not match the expected index");if(a.buffered_input=T,C.onMessage(a),!j)break;f(_,j,O,T,{},t,n),T="",j="",O="",t=void 0,n=void 0;break}case"message_limit":E=JSON.parse(e.data).message_limit;break;case"message_delta":case"message_start":case"message_stop":{let t=JSON.parse(e.data);"message_stop"===t.type&&(w="message_stop"),C.onMessage(t)}}},onclose(){C.model_done=!0},onerror(e){throw(0,s.Cp)(e),C.model_done=!0,C.force_smoother_done=!0,e}});return await Promise.all([I,x]),d=null,{stopReason:w,messageLimitResult:E}}},75632:(e,t,n)=>{n.d(t,{N:()=>a});let a=()=>void 0===crypto.randomUUID?"".concat(1e7,"-",1e3,"-",4e3,"-",8e3,"-",1e11).replace(/[018]/g,e=>{let t=parseInt(e);return(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)}):crypto.randomUUID()},77187:(e,t,n)=>{n.d(t,{Gw:()=>Q,SL:()=>R,Z3:()=>B,c7:()=>M,x:()=>q});var a=n(54568),r=n(7726),i=n(17936),s=n(98518),l=n(10158),o=n(1761),u=n(69916),c=n(18483),d=n(29585),h=n(46612),_=n(55428),p=n(71473),m=n(27062),g=n(75632),f=n(44180),y=n(21036),v=n(87606),k=n(67933),b=n(68864),C=n(27261),x=n.n(C),S=n(62942),w=n(7620),E=n(62971),L=n(46760),T=n(75006),j=n(66442),O=n(57067),D=n(31198),I=n(80079),P=n(19303);let U=(0,w.createContext)([null,null]);function M(e){let{children:t}=e,n=(0,w.useState)({});return(0,a.jsx)(U.Provider,{value:n,children:t})}function Q(e,t,n,a,r,i){let{onIncrementalCompletion:s,onStartAppend:l,onStreamCompleted:o}=(0,P.G)(r,i),u=F({conversationUUID:e,projectUUID:t,endpoint:j.ep.APPEND_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:s,onStreamCompleted:o,onInvokeTool:n,getTools:a}),{runStream:c}=u,d=(0,w.useCallback)(async t=>{let{prompt:n,attachments:a,files:r,syncSources:i,rethrowErrors:s=!1,modelOverride:o,parent_message_uuid:u,personalized_style:d,compass_mode:h,org_type_override:_}=t;await l(e,t=>{if(!t)throw Error("Conversation tree must be provided for tree append");let s=(0,O.ZQ)(t),l=[{uuid:O.Rh,content:[{type:"text",text:n,citations:[]}],created_at:new Date().toISOString(),sender:"human",attachments:a,files:r,files_v2:r,sync_sources:i,index:s+1,parent_message_uuid:null!=u?u:O.gF},{uuid:O.gv+e,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],index:s+2,parent_message_uuid:O.Rh,metadata:{compass_mode:h}}];return(0,O.xQ)(t,l)}),await c({prompt:n,attachments:a,files:r,syncSources:i,rethrowErrors:s,modelOverride:o,parent_message_uuid:u,personalized_style:d,org_type_override:_})},[c,l,e]);return{...u,runStream:d}}function R(e,t,n,a,r,i,s){let{onIncrementalCompletion:l,onStreamCompleted:o,onStartAppend:u}=(0,P.G)(i,s),c=F({conversationUUID:e,projectUUID:t,endpoint:j.ep.RETRY_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:l,onInvokeTool:n,onStreamCompleted:o,getTools:a}),{runStream:d}=c,h=(0,w.useCallback)(async(t,n,a)=>{await u(e,n=>{let a=[{uuid:O.gv+e,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],parent_message_uuid:t,selectedOption:0,index:(0,O.ZQ)(n)+1}];return(0,O.xQ)(n,a)}),await d({prompt:"",attachments:[],files:[],syncSources:[],parent_message_uuid:t,personalized_style:r,paprika_mode:n,compass_mode:a,isRetry:!0})},[e,d,u,r]);return{...c,runStream:h}}let A="incomplete_stream",N=Error(A),z=T.z.object({model:T.z.string().nullable()}).nullable(),B=e=>{let t=K(e),n=(0,m.P0)("tepui_default_on_claude_free","model",null,m.Lu),a=(0,m.GZ)("console_default_model_override","model",null,z),r=(0,m.T9)("console_default_model","model",null,m.Lu);return t||n||(null==a?void 0:a.model)||r||"claude-3-5-haiku-latest"},K=e=>{let t=(0,r.mz)(e||""),n=(0,S.useSearchParams)(),a=null==n?void 0:n.get("model");return(null==t?void 0:t.model)?null==t?void 0:t.model:a||void 0},Y={value:null},q=()=>{let e=(0,v.useQueryClient)();return{failedStreamRetryData:(0,k.useQuery)({queryKey:[p.xT],queryFn:()=>Y.value,initialData:null}).data||null,setFailedStreamRetryData:(0,w.useCallback)(t=>{Y.value=t,e.setQueryData([p.xT],t)},[e])}};function F(e){var t;let{conversationUUID:n,projectUUID:p,endpoint:v,getTools:k,onIncrementalCompletion:C,onInvokeTool:T,onStreamCompleted:O}=e,{applicationType:P}=(0,l._r)(),{activeOrganization:M}=(0,o.YL)(),{value:Q}=(0,m.fS)("apps_no_smoothing"),R=null==M?void 0:M.uuid,{context:z,clearContext:B,setContext:Y}=function(e){let[t,n]=(0,w.useContext)(U),[a,r]=(0,w.useState)(),i=(0,w.useCallback)(()=>{n?n(t=>{let n={...t};return delete n[e],n}):r(void 0)},[e,n]),s=(0,w.useCallback)(t=>{n?n(n=>({...n,[e]:t})):r(t)},[e,n]);return{context:t?t[e]:a,clearContext:i,setContext:s}}(n),F=(0,S.useSearchParams)(),W=null==F?void 0:F.get("t"),H=null!=(t=K(n))?t:"",V=null==F?void 0:F.get("max_tokens"),G=(0,I.$)(),{addError:J,clearToast:X}=(0,u.Y)(),Z=(0,w.useMemo)(g.N,[]),$=(0,r.bT)("push",Z),{setFailedStreamRetryData:ee}=q(),et=(0,w.useCallback)(async e=>{await (null==O?void 0:O(n,e)),B()},[O,n,B]),en=(0,w.useCallback)((e,t,r)=>{if(e===A)return J((0,a.jsx)("p",{children:(0,a.jsx)(E.A,{defaultMessage:"Claude’s response was interrupted. This can be caused by network problems or exceeding the maximum conversation length. Please <link>contact support</link> if the issue persists.",id:"sHRMIfTKu4",values:{link:e=>(0,a.jsx)(x(),{href:"https://support.anthropic.com/en/articles/9015913-how-to-get-support",className:"underline",children:e})}})}),{error:e});if(!(e instanceof d.LG))return J((0,a.jsx)(E.A,{defaultMessage:"We couldn’t connect to Claude. Please check your network connection and try again.",id:"KzO0j4cGtg"}),{error:e});if("rate_limit_error"===e.type){if(e.message.includes("{")&&R)try{let t=JSON.parse(e.message);G(t,R,n)}catch(e){}if("thinking_messages_rate_limit_exceeded"===e.errorCode)return J((0,a.jsxs)("p",{children:[(0,a.jsx)(E.A,{defaultMessage:"You’ve reached your weekly limit for thinking messages. Please try again next week.",id:"uu/l1k2f+L"}),"\xa0",(0,a.jsx)(i.W,{})]}),{error:e});if("opus_messages_rate_limit_exceeded"===e.errorCode)throw e;return J((0,a.jsxs)("p",{children:[(0,a.jsx)(E.A,{defaultMessage:"You’ve reached the limit for Claude messages at this time. Please wait before trying again.",id:"CBMEJMlMzs"}),"\xa0",(0,a.jsx)(i.W,{})]}),{error:e})}if("not_found_error"===e.type)return J((0,a.jsx)(E.A,{defaultMessage:"Claude model version not found.",id:"kdrUaXpTqd"}),{error:e});if("billing_error"===e.type)return J((0,a.jsx)("p",{children:(0,a.jsx)(E.A,{defaultMessage:"We had an unexpected billing error, please <link>contact support.</link>",id:"MBYn4HHrFu",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/9015913-how-can-i-contact-support",target:"_blank",rel:"noreferrer",children:e})}})}),{error:e});if("overloaded_error"===e.type)return J((0,a.jsxs)("p",{children:[(0,a.jsx)(E.A,{defaultMessage:"Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon.",id:"TRpxX8Mu1L"}),"\xa0",(0,a.jsx)(i.W,{})]}),{error:e});if("exceeded_max_uploads_per_message"===e.errorCode)return void J((0,a.jsx)(E.A,{defaultMessage:"Your message will exceed the maximum number of files allowed per message. Consider removing some of your files or adding files over several messages.",id:"/jNwaAHdg9"}),{error:e});if("exceeded_max_image_limit_per_chat"===e.errorCode){let t=J((0,a.jsx)("p",{children:r>0?(0,a.jsx)(E.A,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try uploading {count, plural, one {# document} other {# documents}} with fewer pages, removing images, <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"gltmHPfviz",values:{link:e=>(0,a.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.FP,children:e}),newChatLink:e=>(0,a.jsx)("a",{href:"#",className:"underline",onClick:e=>{e.preventDefault(),$({projectUuid:p}),X(t)},children:e}),upgradeInstructions:()=>(0,a.jsx)(i.W,{}),count:r}}):(0,a.jsx)(E.A,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try removing images <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"QmLhKBubcc",values:{link:e=>(0,a.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.FP,children:e}),newChatLink:e=>(0,a.jsx)("a",{href:"#",className:"underline",onClick:e=>{e.preventDefault(),$({projectUuid:p}),X(t)},children:e}),upgradeInstructions:()=>(0,a.jsx)(i.W,{})}})}),{error:e});return}if("invalid_request_error"===e.type&&413===e.statusCode){let n=J((0,a.jsx)("p",{children:t>0?(0,a.jsx)(E.A,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try attaching fewer or smaller files <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"G1lejdsk5p",values:{link:e=>(0,a.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.q4,children:e}),newChatLink:e=>(0,a.jsx)("a",{href:"#",className:"underline",onClick:e=>{e.preventDefault(),$({projectUuid:p}),X(n)},children:e}),upgradeInstructions:()=>(0,a.jsx)(i.W,{})}}):(0,a.jsx)(E.A,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try shortening your message <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"EWtBrIlAAR",values:{link:e=>(0,a.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.q4,children:e}),newChatLink:e=>(0,a.jsx)("a",{href:"#",className:"underline",onClick:e=>{e.preventDefault(),$({projectUuid:p}),X(n)},children:e}),upgradeInstructions:()=>(0,a.jsx)(i.W,{})}})}),{error:e});return}return"invalid_request_error"===e.type&&"read_only_mode"===e.extra.code?J((0,a.jsx)("p",{children:(0,a.jsx)(E.A,{defaultMessage:"Due to capacity constraints, chatting with Claude is currently not available. Please try again in a little while.",id:"W2dIBW8oIg"})}),{error:e}):J(e instanceof Error?e.message:String(e),{error:e})},[J,R,p,G,n,$,X]),ea=(0,s.st)(),er=(0,y.useExperiment)("no_more_smoother"),ei=(0,L.A)(),es=(0,w.useCallback)(async e=>{let{prompt:t,attachments:a,files:r,syncSources:i,rethrowErrors:s=!1,modelOverride:l,parent_message_uuid:o,personalized_style:u,paprika_mode:h,compass_mode:p,org_type_override:m}=e;if(z)return;if(!M)throw Error("Cannot stream without an organization");let g=new AbortController;Y({controller:g}),ee(null);let y={prompt:t,parent_message_uuid:o,timezone:b.c9.local().zoneName||void 0,personalized_styles:u?[u]:void 0,locale:c.SC.includes(ei.locale)?ei.locale:c.Xn},x=(0,D.x)();x&&(y.custom_system_prompt=x),H&&"string"==typeof H&&(y.model=H),l&&(y.model=l),"string"==typeof W&&(y.temperature=parseInt(W)),V&&"string"==typeof V&&(y.max_tokens_to_sample=parseInt(V)),h&&(y.paprika_mode=h),p&&(y.compass_mode=p);let S=k();S.length&&(y.tools=S);let w=[],E=null,L=null,O=null;try{let e=er.get("no_smoothing",!1);if(E=(O=await (0,j.xD)({applicationType:P,endpoint:v,orgUuid:M.uuid,conversationUuid:n,body:{organization_uuid:M.uuid,conversation_uuid:n,text:t,attachments:a,files:r.map(e=>e.file_uuid),sync_sources:i.map(e=>e.uuid),..."string"==typeof m&&{org_type_override:m}},onCompletion:e=>{C(n,e),w=e},onInvokeTool:T,abortController:g,completion:y,getTools:k,smoothingEnabled:!Q&&!e})).stopReason,L=O.messageLimitResult,O&&!E)throw N}catch(i){let e=i instanceof d.LG;if(ee({prompt:t,attachments:a,files:r}),i===N?(C(n,w),en(A,a.length+r.length,r.filter(e=>"document"===e.file_kind).length),ea.track({event_key:"sse_interrupted"}),(0,f.wd)("sse_interrupted"),await new Promise(e=>setTimeout(e,3e4))):(en(i,a.length+r.length,r.filter(e=>"document"===e.file_kind).length),e||console.error("Non-API stream error:",i)),(0,f.Cp)(i,{tags:{source:e?"stream-api":"stream-generic"}}),s||(0,_.yz)())throw i}finally{await et(L)}return w},[z,M,Y,ee,H,W,V,k,er,P,v,n,T,Q,C,en,et,ea,ei]),el=(0,w.useCallback)(()=>{z&&(z.controller.abort(),B())},[z,B]);return{runStream:es,isStreaming:!!z,abortStream:el}}},80079:(e,t,n)=>{n.d(t,{$:()=>c,T:()=>d});var a=n(77186),r=n(1761),i=n(55554),s=n(71473),l=n(27062),o=n(87606),u=n(7620);let c=()=>{let e=(0,o.useQueryClient)();return(0,u.useCallback)((t,n,a)=>{"within_limit"!==t.type&&(t.conversationUUID=a),e.setQueryData([s.Rw],e=>e?{...e,messageLimits:{...e.messageLimits,[n]:t}}:e)},[e])},d=e=>{let{activeOrganization:t}=(0,r.YL)(),{selectedTier:n}=(0,i.t)(),{value:s}=(0,l.fS)("internal_tier_selector"),o=null==t?void 0:t.uuid,u=c(),d={type:"within_limit"};return(0,a.L2)(()=>"/api/organizations/".concat(o,"/reset_rate_limits"),"POST",{onSuccess:()=>{u(d,o,e||"")},meta:{noToast:!0},transformVariables:()=>s&&n?{org_type:n}:{}})}}}]);