try{let e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="aa1a80b6-eb04-458b-99bb-77bbaf073c75",e._sentryDebugIdIdentifier="sentry-dbid-aa1a80b6-eb04-458b-99bb-77bbaf073c75")}catch(e){}"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6053],{20810:(e,t,n)=>{n.d(t,{_:()=>h});var o=n(21155),a=n(75006);let s=a.z.object({name:a.z.string().optional(),url:a.z.string().optional(),type:a.z.string().optional()}),r=new Set(["accept","accept-language","content-type","content-length"]),c=new Set(["set-cookie","x-api-key","x-auth-token","authorization"]),i=["api.anthropic.com"],l=!1,d=[];async function u(e,t){return l=!0,new Promise(n=>{t({requestedServers:e,onClose:()=>{n();let e=d.shift();e?setTimeout(()=>{u(e.validRequestedServers,e.setArtifactMcpModal).then(()=>{e.resolve()})},100):l=!1}})})}let p={"api.anthropic.com":async(e,t)=>await fetch("/api/organizations/".concat(e,"/proxy/v1/messages"),t)};async function h(e,t,n,o,h,g){let b,{url:y,method:x,headers:z,body:S,channelId:q}=e,f=new URL(y),C={};for(let[e,t]of Object.entries(z))r.has(e.toLowerCase())&&(C[e]=t);o&&(C["anthropic-artifact-id"]=o.uuid,C["anthropic-artifact-entity-type"]=o.type);let R=S;if(g&&h&&S&&i.some(e=>e===f.hostname)){let e=new TextDecoder().decode(S),t=a.z.object({mcp_servers:a.z.array(s).optional()}).passthrough().parse(JSON.parse(e));if(t.mcp_servers&&Array.isArray(t.mcp_servers)){let e=t.mcp_servers.filter(e=>e.url);e.length>0&&(l?await new Promise(t=>{d.push({validRequestedServers:e,setArtifactMcpModal:g,resolve:t})}):await u(e,g));let n=new TextEncoder().encode(JSON.stringify(t));R=n.buffer instanceof ArrayBuffer?n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength):new ArrayBuffer(0)}}let w=new AbortController;if(f.hostname in p)b=await p[f.hostname](n||"",{method:x,headers:C,body:R||void 0,signal:w.signal,redirect:"manual"});else throw Error("Unable to proxy requests for ".concat(f.hostname,"."));let O={};return b.headers.forEach((e,t)=>{c.has(t.toLowerCase())||(O[t]=e)}),m(b,q,t),{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchResponse",status:b.status,statusText:b.statusText,headers:O}}async function m(e,t,n){var a;let s=null==(a=e.body)?void 0:a.getReader();if(!s)return void await n(o.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!0});let r=0;try{for(;;){let{done:e,value:a}=await s.read();if(e){await n(o.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!0});break}if(a){let e;if((r+=a.byteLength)>0xa00000)throw Error("Response body exceeds maximum size of ".concat(0xa00000," bytes"));let s=0===a.byteOffset&&a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength);e=s instanceof ArrayBuffer?s:new Uint8Array(s).slice().buffer,await n(o.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:e,done:!1},[e])}}}catch(e){await n(o.uZ.ProxyFetchStream,{"@type":"type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest",channelId:t,chunk:null,done:!1,error:e instanceof Error?e.message:"Unknown error"})}finally{s.releaseLock()}}},21155:(e,t,n)=>{n.d(t,{K_:()=>b,Ub:()=>m,tH:()=>z,uZ:()=>r,v9:()=>x,x8:()=>y,zN:()=>h});var o=n(54890),a=n(75006),s=n(44124),r=function(e){return e.ReadyForContent="anthropic.claude.usercontent.sandbox.ReadyForContent",e.SetContent="anthropic.claude.usercontent.sandbox.SetContent",e.GetFile="anthropic.claude.usercontent.sandbox.GetFile",e.SendConversationMessage="anthropic.claude.usercontent.sandbox.SendConversationMessage",e.RunCode="anthropic.claude.usercontent.sandbox.RunCode",e.ClaudeCompletion="anthropic.claude.usercontent.sandbox.ClaudeCompletion",e.ReportError="anthropic.claude.usercontent.sandbox.ReportError",e.GetScreenshot="anthropic.claude.usercontent.sandbox.GetScreenshot",e.BroadcastContentSize="anthropic.claude.usercontent.sandbox.BroadcastContentSize",e.OpenExternal="anthropic.claude.usercontent.sandbox.OpenExternal",e.DownloadFile="anthropic.claude.usercontent.sandbox.DownloadFile",e.CopyHtmlContent="anthropic.claude.usercontent.sandbox.CopyHtmlContent",e.TrackInteraction="anthropic.claude.usercontent.sandbox.TrackInteraction",e.ProxyFetch="anthropic.claude.usercontent.sandbox.ProxyFetch",e.ProxyFetchStream="anthropic.claude.usercontent.sandbox.ProxyFetchStream",e.GetDOMSnapshot="anthropic.claude.usercontent.sandbox.GetDOMSnapshot",e.DOMContentLoaded="anthropic.claude.usercontent.sandbox.DOMContentLoaded",e.StorageGet="anthropic.claude.usercontent.sandbox.StorageGet",e.StorageSet="anthropic.claude.usercontent.sandbox.StorageSet",e.StorageDelete="anthropic.claude.usercontent.sandbox.StorageDelete",e.StorageList="anthropic.claude.usercontent.sandbox.StorageList",e}({});let c=a.z.object({type:a.z.literal("UnsupportedImports"),unsupportedModules:a.z.array(a.z.string()),nonExistentIcons:a.z.array(a.z.string())}),i=a.z.object({type:a.z.literal("RuntimeError"),message:a.z.string()}),l=a.z.object({type:a.z.literal("FileNotFound"),fileName:a.z.string()}),d=a.z.object({type:a.z.literal("ClaudeCompletionError"),message:a.z.string()}),u=a.z.object({type:a.z.literal("ArtifactStorageError"),message:a.z.string()}),p=a.z.discriminatedUnion("type",[c,i,l,d,u]),h=a.z.object({code:a.z.string()}),m=a.z.object({status:a.z.enum(["success","error"]),result:a.z.string().optional(),logs:a.z.array(a.z.string()),error:a.z.string().optional()}),g={"anthropic.claude.usercontent.sandbox.CopyHtmlContent":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.CopyHtmlContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.CopyHtmlContentResponse"),reportHTMLContent:a.z.string()})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SetContent":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SetContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SandboxContent"),content:a.z.string(),type:a.z.union([a.z.nativeEnum(o.vU),a.z.nativeEnum(o.qK)]),watchContentSize:a.z.boolean().optional(),tailwindStylesEnabled:a.z.boolean().optional()})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReadyForContent":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReadyForContent"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.BroadcastContentSize":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.BroadcastContentSize"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.BroadcastContentSizePayload"),height:a.z.number(),width:a.z.number()})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetFile":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetFile"),payload:a.z.strictObject({key:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({value:a.z.instanceof(Uint8Array).nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetFileResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.SendConversationMessage":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.SendConversationMessage"),payload:a.z.strictObject({message:a.z.string(),messageType:a.z.enum(["text","error"]),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.SendConversationMessageRequest")})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.RunCode":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.RunCode"),payload:a.z.strictObject({code:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.RunCodeResponse")}).merge(m)}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ClaudeCompletion":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ClaudeCompletion"),payload:a.z.strictObject({prompt:a.z.string(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({completion:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ClaudeCompletionResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ReportError":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ReportError"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ReportErrorRequest"),error:p})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.GetScreenshot":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetScreenshot"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({screenshot:a.z.string().nullable(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetScreenshotResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.OpenExternal":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.OpenExternal"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.OpenExternal"),href:a.z.string()})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.DownloadFile":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.DownloadFile"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.DownloadFile"),filename:a.z.string(),data:a.z.instanceof(ArrayBuffer),mimeType:a.z.string()})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.TrackInteraction":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.TrackInteraction"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.TrackInteraction"),interactionType:a.z.literal("click")})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.ProxyFetch":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ProxyFetch"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchRequest"),url:a.z.string(),method:a.z.string(),headers:a.z.record(a.z.string()),body:a.z.instanceof(ArrayBuffer).nullable(),channelId:a.z.string()})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchResponse"),status:a.z.number(),statusText:a.z.string(),headers:a.z.record(a.z.string())})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.ProxyFetchStream":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.ProxyFetchStream"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.ProxyFetchStreamRequest"),channelId:a.z.string(),chunk:a.z.instanceof(ArrayBuffer).nullable(),done:a.z.boolean(),error:a.z.string().optional()})}),responseSchema:s.gq,alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.GetDOMSnapshot":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.GetDOMSnapshot"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.GetDOMSnapshotResponse"),domSnapshot:a.z.string().nullable()})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.DOMContentLoaded":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.DOMContentLoaded"),payload:a.z.strictObject({"@type":a.z.literal("type.googleapis.com/google.protobuf.Empty")})}),responseSchema:s.gq,alwaysPermitted:!0},"anthropic.claude.usercontent.sandbox.StorageGet":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.StorageGet"),payload:a.z.strictObject({key:a.z.string(),shared:a.z.boolean().optional().default(!1),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageGetRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({key:a.z.string(),value:a.z.string(),shared:a.z.boolean(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageGetResponse")}).nullable()}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.StorageSet":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.StorageSet"),payload:a.z.strictObject({key:a.z.string(),value:a.z.string(),shared:a.z.boolean().optional().default(!1),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageSetRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({key:a.z.string(),value:a.z.string(),shared:a.z.boolean(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageSetResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.StorageDelete":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.StorageDelete"),payload:a.z.strictObject({key:a.z.string(),shared:a.z.boolean().optional().default(!1),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageDeleteRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({key:a.z.string(),deleted:a.z.boolean(),shared:a.z.boolean(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageDeleteResponse")})}),alwaysPermitted:!1},"anthropic.claude.usercontent.sandbox.StorageList":{requestSchema:s.Uq.extend({method:a.z.literal("anthropic.claude.usercontent.sandbox.StorageList"),payload:a.z.strictObject({prefix:a.z.string().optional(),shared:a.z.boolean().optional().default(!1),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageListRequest")})}),responseSchema:s.Ko.extend({payload:a.z.strictObject({keys:a.z.array(a.z.string()),prefix:a.z.string().nullable().optional(),shared:a.z.boolean(),"@type":a.z.literal("type.googleapis.com/anthropic.claude.usercontent.sandbox.StorageListResponse")})}),alwaysPermitted:!1}},b=a.z.enum(["anthropic.claude.usercontent.sandbox.ReadyForContent","anthropic.claude.usercontent.sandbox.GetFile","anthropic.claude.usercontent.sandbox.SendConversationMessage","anthropic.claude.usercontent.sandbox.ClaudeCompletion","anthropic.claude.usercontent.sandbox.ReportError","anthropic.claude.usercontent.sandbox.BroadcastContentSize","anthropic.claude.usercontent.sandbox.OpenExternal","anthropic.claude.usercontent.sandbox.DownloadFile","anthropic.claude.usercontent.sandbox.TrackInteraction","anthropic.claude.usercontent.sandbox.ProxyFetch","anthropic.claude.usercontent.sandbox.DOMContentLoaded","anthropic.claude.usercontent.sandbox.StorageGet","anthropic.claude.usercontent.sandbox.StorageSet","anthropic.claude.usercontent.sandbox.StorageDelete","anthropic.claude.usercontent.sandbox.StorageList"]),y=a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.ReadyForContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].requestSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].requestSchema,g["anthropic.claude.usercontent.sandbox.ReportError"].requestSchema,g["anthropic.claude.usercontent.sandbox.BroadcastContentSize"].requestSchema,g["anthropic.claude.usercontent.sandbox.OpenExternal"].requestSchema,g["anthropic.claude.usercontent.sandbox.DownloadFile"].requestSchema,g["anthropic.claude.usercontent.sandbox.TrackInteraction"].requestSchema,g["anthropic.claude.usercontent.sandbox.ProxyFetch"].requestSchema,g["anthropic.claude.usercontent.sandbox.DOMContentLoaded"].requestSchema,g["anthropic.claude.usercontent.sandbox.StorageGet"].requestSchema,g["anthropic.claude.usercontent.sandbox.StorageSet"].requestSchema,g["anthropic.claude.usercontent.sandbox.StorageDelete"].requestSchema,g["anthropic.claude.usercontent.sandbox.StorageList"].requestSchema]);a.z.union([s.gq,g["anthropic.claude.usercontent.sandbox.GetFile"].responseSchema,g["anthropic.claude.usercontent.sandbox.SendConversationMessage"].responseSchema,g["anthropic.claude.usercontent.sandbox.ClaudeCompletion"].responseSchema,g["anthropic.claude.usercontent.sandbox.ProxyFetch"].responseSchema,g["anthropic.claude.usercontent.sandbox.StorageGet"].responseSchema,g["anthropic.claude.usercontent.sandbox.StorageSet"].responseSchema,g["anthropic.claude.usercontent.sandbox.StorageDelete"].responseSchema,g["anthropic.claude.usercontent.sandbox.StorageList"].responseSchema]),a.z.enum(["anthropic.claude.usercontent.sandbox.SetContent","anthropic.claude.usercontent.sandbox.RunCode","anthropic.claude.usercontent.sandbox.GetScreenshot","anthropic.claude.usercontent.sandbox.CopyHtmlContent","anthropic.claude.usercontent.sandbox.ProxyFetchStream","anthropic.claude.usercontent.sandbox.GetDOMSnapshot"]),a.z.discriminatedUnion("method",[g["anthropic.claude.usercontent.sandbox.SetContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].requestSchema,g["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].requestSchema,g["anthropic.claude.usercontent.sandbox.ProxyFetchStream"].requestSchema,g["anthropic.claude.usercontent.sandbox.GetDOMSnapshot"].requestSchema]);let x=a.z.union([g["anthropic.claude.usercontent.sandbox.SetContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.RunCode"].responseSchema,g["anthropic.claude.usercontent.sandbox.GetScreenshot"].responseSchema,g["anthropic.claude.usercontent.sandbox.CopyHtmlContent"].responseSchema,g["anthropic.claude.usercontent.sandbox.ProxyFetchStream"].responseSchema,g["anthropic.claude.usercontent.sandbox.GetDOMSnapshot"].responseSchema]),z=Object.entries(g).filter(e=>{let[t,n]=e;return!0===n.alwaysPermitted}).map(e=>{let[t,n]=e;return t})},44124:(e,t,n)=>{n.d(t,{Ko:()=>r,SV:()=>d,Uq:()=>s,_s:()=>a,gq:()=>i,qs:()=>l,t6:()=>c});var o=n(75006);let a=o.z.object({channel:o.z.enum(["request","response"]),requestId:o.z.string()}).passthrough(),s=a.strict().extend({channel:o.z.literal("request"),method:o.z.string(),payload:o.z.strictObject({"@type":o.z.string()})}),r=a.extend({channel:o.z.literal("response"),status:o.z.number().int().min(100).max(599),payload:o.z.strictObject({"@type":o.z.string()}).passthrough()}).passthrough(),c=r.extend({status:o.z.number().int().min(400).max(599),payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/anthropic.claude.usercontent.ErrorResponse"),error:o.z.string()})}),i=r.extend({payload:o.z.strictObject({"@type":o.z.literal("type.googleapis.com/google.protobuf.Empty")})}),l={"@type":"type.googleapis.com/google.protobuf.Empty"},d=e=>({"@type":"type.googleapis.com/anthropic.claude.usercontent.ErrorResponse",error:e})},53120:(e,t,n)=>{n.d(t,{x:()=>r});var o=n(21155),a=n(44124);let s=new Map;class r{setupMessageListener(){window.addEventListener("message",this.boundHandleMessage,!1)}handleMessage(e){if(e.origin!==this.allowedOrigin||e.source!==this.iframe.contentWindow)return;let t=Date.now();if(t-this.lastResetTime>this.RESET_INTERVAL&&(this.messageCount=0,this.lastResetTime=t),this.messageCount++,this.messageCount>this.MAX_MESSAGES_PER_INTERVAL){window.removeEventListener("message",this.boundHandleMessage),this.onRateLimited&&this.onRateLimited();return}let n=a._s.safeParse(e.data);if(!n.success)return void console.warn("Received message does not conform to basic message shape, ignoring");let o=n.data;if("response"===o.channel)return void this.handleResponse(o);this.messageQueue.push(o),this.isConsumerRunning||this.consumeMessages()}handleResponse(e){let t=this.inFlightRequests.get(e.requestId)||s.get(e.requestId);if(void 0!==t){t(e),s.delete(e.requestId);return}}async consumeMessages(){for(this.isConsumerRunning=!0;this.messageQueue.length>0;){let e=this.messageQueue.shift();if(!e)continue;let t=o.K_.safeParse(e.method);if(!t.success){this.sendErrorResponse(e.requestId,400,"Unknown method");continue}let n=t.data,s=o.x8.safeParse(e);if(!s.success){this.sendErrorResponse(e.requestId,400,"Invalid payload content");continue}let r=s.data;if(this.requestLog.has(r.requestId)){this.sendErrorResponse(r.requestId,400,"Request ID already processed");continue}this.requestLog.set(r.requestId,{message:r,requestTimestamp:new Date().getTime()}),await this.onPermissionRequested(n).then(e=>"denied"!==e||(this.sendErrorResponse(r.requestId,403,"Permission denied"),!1)).catch(e=>(console.error("Error checking permission for method ".concat(n,":"),e),this.sendErrorResponse(r.requestId,500,"Error checking permission"),!1))&&(this.onCapabilityAction(r,this.boundSendRequest).then(e=>{var t;let n=a.Ko.parse({channel:"response",status:200,requestId:r.requestId,payload:null!=e?e:a.qs}),o=this.requestLog.get(r.requestId);o&&this.requestLog.set(r.requestId,{...o,response:n,responseTimestamp:new Date().getTime()}),null==(t=this.iframe.contentWindow)||t.postMessage(n,this.allowedOrigin)}).catch(e=>{console.error("Error processing action for method ".concat(n,":"),e),this.sendErrorResponse(r.requestId,500,"Internal server error while processing action")}),await new Promise(e=>requestAnimationFrame(e)))}this.isConsumerRunning=!1}sendErrorResponse(e,t,n){var o;let s=a.t6.parse({channel:"response",status:t,requestId:e,payload:(0,a.SV)(n)}),r=this.requestLog.get(e);r&&this.requestLog.set(e,{...r,response:s,responseTimestamp:new Date().getTime()}),null==(o=this.iframe.contentWindow)||o.postMessage(s,this.allowedOrigin)}restartListening(){window.removeEventListener("message",this.boundHandleMessage),this.messageCount=0,this.lastResetTime=Date.now(),this.setupMessageListener()}cleanup(){window.removeEventListener("message",this.boundHandleMessage),this.messageQueue=[],this.isConsumerRunning=!1,this.inFlightRequests.clear()}async sendRequest(e,t,n){return new Promise((r,c)=>{var i,l;let d=Date.now().toString(),u={channel:"request",method:e,requestId:d,payload:t},p=e=>{let t=a.Ko.safeParse(e);if(!t.success)return void c(Error("Invalid response format"));let n=t.data;if(n.status>=400){let e=a.t6.safeParse(n);e.success?c(Error(e.data.payload.error)):c(Error("Error response (".concat(n.status,")")));return}let s=o.v9.safeParse(n);s.success?r(s.data.payload):c(Error("Invalid response payload for the method"))};this.inFlightRequests.set(d,p),s.set(d,p),n&&n.length>0?null==(i=this.iframe.contentWindow)||i.postMessage(u,this.allowedOrigin,n):null==(l=this.iframe.contentWindow)||l.postMessage(u,this.allowedOrigin)})}getRequestLog(){return Array.from(this.requestLog.entries()).map(e=>{let[t,n]=e;return{...n,requestId:t}}).sort((e,t)=>t.requestTimestamp-e.requestTimestamp)}constructor({iframe:e,allowedOrigin:t,onRateLimited:n=null,onPermissionRequested:o,onCapabilityAction:a}){this.messageCount=0,this.lastResetTime=Date.now(),this.MAX_MESSAGES_PER_INTERVAL=30,this.RESET_INTERVAL=5e3,this.onRateLimited=null,this.messageQueue=[],this.isConsumerRunning=!1,this.requestLog=new Map,this.inFlightRequests=new Map,this.iframe=e,this.allowedOrigin=t,this.onRateLimited=n,this.onPermissionRequested=o,this.onCapabilityAction=a,this.boundHandleMessage=this.handleMessage.bind(this),this.boundSendRequest=this.sendRequest.bind(this),this.setupMessageListener()}}}}]);